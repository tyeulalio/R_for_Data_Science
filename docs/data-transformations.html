<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Data transformations | Working Through R for Data Science</title>
  <meta name="description" content="This book goes through the chapters and exercises of the R for Data Science Book" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Data transformations | Working Through R for Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book goes through the chapters and exercises of the R for Data Science Book" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Data transformations | Working Through R for Data Science" />
  
  <meta name="twitter:description" content="This book goes through the chapters and exercises of the R for Data Science Book" />
  

<meta name="author" content="Tiffany Eulalio" />


<meta name="date" content="2021-08-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="workflow.html"/>
<link rel="next" href="workflow-scripts.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Working Through R for Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="ch-1-and-2.html"><a href="ch-1-and-2.html"><i class="fa fa-check"></i><b>2</b> Chapters 1 and 2</a></li>
<li class="chapter" data-level="3" data-path="data-vizualization.html"><a href="data-vizualization.html"><i class="fa fa-check"></i><b>3</b> Data Visualization</a><ul>
<li class="chapter" data-level="3.1" data-path="data-vizualization.html"><a href="data-vizualization.html#skipping-this-section"><i class="fa fa-check"></i><b>3.1</b> Skipping this section</a></li>
<li class="chapter" data-level="3.2" data-path="data-vizualization.html"><a href="data-vizualization.html#first-steps"><i class="fa fa-check"></i><b>3.2</b> First Steps</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-vizualization.html"><a href="data-vizualization.html#the-mpg-data-frame"><i class="fa fa-check"></i><b>3.2.1</b> The <code>mpg</code> data frame</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-vizualization.html"><a href="data-vizualization.html#creating-a-ggplot"><i class="fa fa-check"></i><b>3.2.2</b> Creating a ggplot</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-vizualization.html"><a href="data-vizualization.html#notes-on-ggplot"><i class="fa fa-check"></i><b>3.2.3</b> Notes on <code>ggplot</code></a></li>
<li class="chapter" data-level="3.2.4" data-path="data-vizualization.html"><a href="data-vizualization.html#exercises"><i class="fa fa-check"></i><b>3.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-vizualization.html"><a href="data-vizualization.html#aesthetic-mappings"><i class="fa fa-check"></i><b>3.3</b> Aesthetic mappings</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-vizualization.html"><a href="data-vizualization.html#exercises-1"><i class="fa fa-check"></i><b>3.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-vizualization.html"><a href="data-vizualization.html#skipping-this-section-1"><i class="fa fa-check"></i><b>3.4</b> Skipping this section</a></li>
<li class="chapter" data-level="3.5" data-path="data-vizualization.html"><a href="data-vizualization.html#facets"><i class="fa fa-check"></i><b>3.5</b> Facets</a><ul>
<li class="chapter" data-level="3.5.1" data-path="data-vizualization.html"><a href="data-vizualization.html#exercises-2"><i class="fa fa-check"></i><b>3.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="data-vizualization.html"><a href="data-vizualization.html#geometric-objects"><i class="fa fa-check"></i><b>3.6</b> Geometric Objects</a><ul>
<li class="chapter" data-level="3.6.1" data-path="data-vizualization.html"><a href="data-vizualization.html#exercises-3"><i class="fa fa-check"></i><b>3.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="data-vizualization.html"><a href="data-vizualization.html#statistical-transformations"><i class="fa fa-check"></i><b>3.7</b> Statistical transformations</a><ul>
<li class="chapter" data-level="3.7.1" data-path="data-vizualization.html"><a href="data-vizualization.html#exercises-4"><i class="fa fa-check"></i><b>3.7.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="data-vizualization.html"><a href="data-vizualization.html#position-adjustments"><i class="fa fa-check"></i><b>3.8</b> Position adjustments</a><ul>
<li class="chapter" data-level="3.8.1" data-path="data-vizualization.html"><a href="data-vizualization.html#exercises-5"><i class="fa fa-check"></i><b>3.8.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="data-vizualization.html"><a href="data-vizualization.html#coordinate-systems"><i class="fa fa-check"></i><b>3.9</b> Coordinate Systems</a><ul>
<li class="chapter" data-level="3.9.1" data-path="data-vizualization.html"><a href="data-vizualization.html#exercises-6"><i class="fa fa-check"></i><b>3.9.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="data-vizualization.html"><a href="data-vizualization.html#the-layered-grammar-of-graphics"><i class="fa fa-check"></i><b>3.10</b> The layered grammar of graphics</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>4</b> Workflow: basics</a></li>
<li class="chapter" data-level="5" data-path="data-transformations.html"><a href="data-transformations.html"><i class="fa fa-check"></i><b>5</b> Data transformations</a><ul>
<li class="chapter" data-level="5.1" data-path="data-transformations.html"><a href="data-transformations.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a><ul>
<li class="chapter" data-level="5.1.1" data-path="data-transformations.html"><a href="data-transformations.html#prerequisites"><i class="fa fa-check"></i><b>5.1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="5.1.2" data-path="data-transformations.html"><a href="data-transformations.html#nycflights13"><i class="fa fa-check"></i><b>5.1.2</b> nycflights13</a></li>
<li class="chapter" data-level="5.1.3" data-path="data-transformations.html"><a href="data-transformations.html#dplyr-basics"><i class="fa fa-check"></i><b>5.1.3</b> dplyr basics</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-transformations.html"><a href="data-transformations.html#filter-rows-with-filter"><i class="fa fa-check"></i><b>5.2</b> Filter rows with <code>filter()</code></a><ul>
<li class="chapter" data-level="5.2.1" data-path="data-transformations.html"><a href="data-transformations.html#skip-section"><i class="fa fa-check"></i><b>5.2.1</b> Skip section</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-transformations.html"><a href="data-transformations.html#logical-operators"><i class="fa fa-check"></i><b>5.2.2</b> Logical operators</a></li>
<li class="chapter" data-level="5.2.3" data-path="data-transformations.html"><a href="data-transformations.html#missing-values"><i class="fa fa-check"></i><b>5.2.3</b> Missing Values</a></li>
<li class="chapter" data-level="5.2.4" data-path="data-transformations.html"><a href="data-transformations.html#exercises-7"><i class="fa fa-check"></i><b>5.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-transformations.html"><a href="data-transformations.html#arrange-rows-with-arrange"><i class="fa fa-check"></i><b>5.3</b> Arrange rows with <code>arrange()</code></a><ul>
<li class="chapter" data-level="5.3.1" data-path="data-transformations.html"><a href="data-transformations.html#exercises-8"><i class="fa fa-check"></i><b>5.3.1</b> 5.3.1 Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="data-transformations.html"><a href="data-transformations.html#selection-columns-with-select"><i class="fa fa-check"></i><b>5.4</b> Selection columns with <code>select()</code></a><ul>
<li class="chapter" data-level="5.4.1" data-path="data-transformations.html"><a href="data-transformations.html#exercises-9"><i class="fa fa-check"></i><b>5.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-transformations.html"><a href="data-transformations.html#add-new-variables-with-mutate"><i class="fa fa-check"></i><b>5.5</b> Add new variables with <code>mutate()</code></a><ul>
<li class="chapter" data-level="5.5.1" data-path="data-transformations.html"><a href="data-transformations.html#useful-creation-functions"><i class="fa fa-check"></i><b>5.5.1</b> Useful creation functions</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-transformations.html"><a href="data-transformations.html#exercises-10"><i class="fa fa-check"></i><b>5.5.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="data-transformations.html"><a href="data-transformations.html#grouped-summaries-with-summarise"><i class="fa fa-check"></i><b>5.6</b> 5.6 Grouped summaries with <code>summarise()</code></a><ul>
<li class="chapter" data-level="5.6.1" data-path="data-transformations.html"><a href="data-transformations.html#combining-multiple-operations-with-the-pipe"><i class="fa fa-check"></i><b>5.6.1</b> Combining multiple operations with the pipe</a></li>
<li class="chapter" data-level="5.6.2" data-path="data-transformations.html"><a href="data-transformations.html#missing-values-1"><i class="fa fa-check"></i><b>5.6.2</b> Missing values</a></li>
<li class="chapter" data-level="5.6.3" data-path="data-transformations.html"><a href="data-transformations.html#counts"><i class="fa fa-check"></i><b>5.6.3</b> Counts</a></li>
<li class="chapter" data-level="5.6.4" data-path="data-transformations.html"><a href="data-transformations.html#useful-summary-functions"><i class="fa fa-check"></i><b>5.6.4</b> Useful summary functions</a></li>
<li class="chapter" data-level="5.6.5" data-path="data-transformations.html"><a href="data-transformations.html#grouping-by-multiple-variables"><i class="fa fa-check"></i><b>5.6.5</b> Grouping by multiple variables</a></li>
<li class="chapter" data-level="5.6.6" data-path="data-transformations.html"><a href="data-transformations.html#ungrouping"><i class="fa fa-check"></i><b>5.6.6</b> Ungrouping</a></li>
<li class="chapter" data-level="5.6.7" data-path="data-transformations.html"><a href="data-transformations.html#exercises-11"><i class="fa fa-check"></i><b>5.6.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="data-transformations.html"><a href="data-transformations.html#grouped-mutates-and-filters"><i class="fa fa-check"></i><b>5.7</b> Grouped mutates (and filters)</a><ul>
<li class="chapter" data-level="5.7.1" data-path="data-transformations.html"><a href="data-transformations.html#exercises-12"><i class="fa fa-check"></i><b>5.7.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="workflow-scripts.html"><a href="workflow-scripts.html"><i class="fa fa-check"></i><b>6</b> Workflow Scripts</a></li>
<li class="chapter" data-level="7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>7</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="7.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#skip-section-1"><i class="fa fa-check"></i><b>7.1</b> Skip section</a></li>
<li class="chapter" data-level="7.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#questions"><i class="fa fa-check"></i><b>7.2</b> Questions</a></li>
<li class="chapter" data-level="7.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#variation"><i class="fa fa-check"></i><b>7.3</b> Variation</a><ul>
<li class="chapter" data-level="7.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualising-distributions"><i class="fa fa-check"></i><b>7.3.1</b> Visualising distributions</a></li>
<li class="chapter" data-level="7.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#typical-values"><i class="fa fa-check"></i><b>7.3.2</b> Typical values</a></li>
<li class="chapter" data-level="7.3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#unusual-values"><i class="fa fa-check"></i><b>7.3.3</b> Unusual values</a></li>
<li class="chapter" data-level="7.3.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#excercises"><i class="fa fa-check"></i><b>7.3.4</b> Excercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-values-2"><i class="fa fa-check"></i><b>7.4</b> Missing values</a><ul>
<li class="chapter" data-level="7.4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercises-13"><i class="fa fa-check"></i><b>7.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#covariation"><i class="fa fa-check"></i><b>7.5</b> Covariation</a><ul>
<li class="chapter" data-level="7.5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#a-categorical-and-continuous-variable"><i class="fa fa-check"></i><b>7.5.1</b> A categorical and continuous variable</a></li>
<li class="chapter" data-level="7.5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#two-categorical-variables"><i class="fa fa-check"></i><b>7.5.2</b> Two Categorical variables</a></li>
<li class="chapter" data-level="7.5.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#two-continuous-variables"><i class="fa fa-check"></i><b>7.5.3</b> Two continuous variables</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#skip-section-2"><i class="fa fa-check"></i><b>7.6</b> Skip section</a></li>
<li class="chapter" data-level="7.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#skip-section-3"><i class="fa fa-check"></i><b>7.7</b> Skip section</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="workflow-projects.html"><a href="workflow-projects.html"><i class="fa fa-check"></i><b>8</b> Workflow Projects</a></li>
<li class="chapter" data-level="9" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>9</b> Introduction</a></li>
<li class="chapter" data-level="10" data-path="tibbles.html"><a href="tibbles.html"><i class="fa fa-check"></i><b>10</b> Tibbles</a><ul>
<li class="chapter" data-level="10.1" data-path="tibbles.html"><a href="tibbles.html#introduction-2"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="tibbles.html"><a href="tibbles.html#creating-tibbles"><i class="fa fa-check"></i><b>10.2</b> Creating tibbles</a></li>
<li class="chapter" data-level="10.3" data-path="tibbles.html"><a href="tibbles.html#tibbles-vs.-data.frame"><i class="fa fa-check"></i><b>10.3</b> Tibbles vs. data.frame</a><ul>
<li class="chapter" data-level="10.3.1" data-path="tibbles.html"><a href="tibbles.html#printing"><i class="fa fa-check"></i><b>10.3.1</b> Printing</a></li>
<li class="chapter" data-level="10.3.2" data-path="tibbles.html"><a href="tibbles.html#subsetting"><i class="fa fa-check"></i><b>10.3.2</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="tibbles.html"><a href="tibbles.html#interacting-with-older-code"><i class="fa fa-check"></i><b>10.4</b> Interacting with older code</a></li>
<li class="chapter" data-level="10.5" data-path="tibbles.html"><a href="tibbles.html#exercises-17"><i class="fa fa-check"></i><b>10.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="data-import.html"><a href="data-import.html"><i class="fa fa-check"></i><b>11</b> Data Import</a><ul>
<li class="chapter" data-level="11.1" data-path="data-import.html"><a href="data-import.html#skip-section-4"><i class="fa fa-check"></i><b>11.1</b> Skip section</a></li>
<li class="chapter" data-level="11.2" data-path="data-import.html"><a href="data-import.html#getting-started"><i class="fa fa-check"></i><b>11.2</b> Getting Started</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Working Through R for Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data_transformations" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Data transformations</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">5.1</span> Introduction</h2>
<div id="prerequisites" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Prerequisites</h3>
<p>We’ll be using the <code>nycflights13</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-transformations.html#cb2-1"></a><span class="kw">library</span>(nycflights13)</span>
<span id="cb2-2"><a href="data-transformations.html#cb2-2"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
</div>
<div id="nycflights13" class="section level3">
<h3><span class="header-section-number">5.1.2</span> nycflights13</h3>
<p>We’ll be using the <code>flights</code> dataframe from the <code>nycflights13</code> package. This dataframe contains all 336,776 flights that departed from New York City in 2013. This data frame comes from the Bureau of Transportation Statistics.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-transformations.html#cb3-1"></a><span class="kw">head</span>(flights)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 19
##    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     1     1      517            515         2      830            819
## 2  2013     1     1      533            529         4      850            830
## 3  2013     1     1      542            540         2      923            850
## 4  2013     1     1      544            545        -1     1004           1022
## 5  2013     1     1      554            600        -6      812            837
## 6  2013     1     1      554            558        -4      740            728
## # ... with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>The data is actualy in <em>tibble</em> form. A tibble is a dataframe that is slightly tweaked to work better in the tidyverse. More details on tibbles will be in the <em>wrangle</em> section.</p>
</div>
<div id="dplyr-basics" class="section level3">
<h3><span class="header-section-number">5.1.3</span> dplyr basics</h3>
<p>This chapter will introduce the five key <code>dplyr</code> functions that will allow us to solve the vast majority of data manipulation challenges.</p>
<ul>
<li>Pick observations by their values: <code>filter()</code></li>
<li>Reorder the rows: <code>arrange()</code></li>
<li>Pick variables by their names: <code>select()</code></li>
<li>Create new variables with functions of existing variables: <code>mutate()</code></li>
<li>Collapse many values down to a single summary: `summarise()</li>
</ul>
<p>These can all be used with <code>group_by()</code> which changes the scope of each function from operating on the entire dataset to operating on it group-by-group. These six functions provide the verbs for a language of data manipulation.</p>
<p>All verbs work similary:</p>
<ol style="list-style-type: decimal">
<li>The first argument is a data frame.</li>
<li>The subsequent arguments describe what to do with the data frame, using the variable names (without quotes).</li>
<li>The result is a new data frame.</li>
</ol>
</div>
</div>
<div id="filter-rows-with-filter" class="section level2">
<h2><span class="header-section-number">5.2</span> Filter rows with <code>filter()</code></h2>
<p><code>filter()</code> allows you to subset observations based on their values. The first argument is the dataframe. The second and subsequent arguments are the expressions that filter the dataframe.</p>
<p>For example, we can select all the flights on January 1st with:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-transformations.html#cb5-1"></a><span class="kw">filter</span>(flights, month<span class="op">==</span><span class="dv">1</span>, day<span class="op">==</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 832 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>We can store the filtered dataframe in a variable.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-transformations.html#cb7-1"></a>jan1 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month<span class="op">==</span><span class="dv">1</span>, day<span class="op">==</span><span class="dv">1</span>)</span></code></pre></div>
<div id="skip-section" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Skip section</h3>
</div>
<div id="logical-operators" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Logical operators</h3>
<p>We can use logical operators with <code>filter</code> to do more complex commands. Say we wanted to get all flights in November or December. We could do</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-transformations.html#cb8-1"></a><span class="kw">filter</span>(flights, month<span class="op">==</span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>month<span class="op">==</span><span class="dv">12</span>)</span></code></pre></div>
<pre><code>## # A tibble: 55,139 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 55,129 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>A useful short-hand for this is <code>x %in% y</code>. This allows us select every row where <span class="math inline">\(x\)</span> is one of the values in <span class="math inline">\(y\)</span>. We can rewrite the code above as</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-transformations.html#cb10-1"></a>nov_dev &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">11</span>,<span class="dv">12</span>))</span></code></pre></div>
</div>
<div id="missing-values" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Missing Values</h3>
<p><code>filter()</code> only includes rows where the condition is true. If you want to keep <code>NA</code> values then ask for them explicitly.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-transformations.html#cb11-1"></a><span class="co"># create a tibble</span></span>
<span id="cb11-2"><a href="data-transformations.html#cb11-2"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">3</span>))</span>
<span id="cb11-3"><a href="data-transformations.html#cb11-3"></a><span class="co"># doesn&#39;t return NA</span></span>
<span id="cb11-4"><a href="data-transformations.html#cb11-4"></a><span class="kw">filter</span>(df, x<span class="op">&gt;</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       x
##   &lt;dbl&gt;
## 1     3</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-transformations.html#cb13-1"></a><span class="co"># returns NA rows</span></span>
<span id="cb13-2"><a href="data-transformations.html#cb13-2"></a><span class="kw">filter</span>(df, <span class="kw">is.na</span>(x) <span class="op">|</span><span class="st"> </span>x<span class="op">&gt;</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 1
##       x
##   &lt;dbl&gt;
## 1    NA
## 2     3</code></pre>
</div>
<div id="exercises-7" class="section level3">
<h3><span class="header-section-number">5.2.4</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>Final all flights that</li>
<li>Had an arrival delay of two or more hours</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-transformations.html#cb15-1"></a><span class="kw">filter</span>(flights, arr_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 127,929 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      554            558        -4      740            728
##  5  2013     1     1      555            600        -5      913            854
##  6  2013     1     1      558            600        -2      753            745
##  7  2013     1     1      558            600        -2      924            917
##  8  2013     1     1      559            600        -1      941            910
##  9  2013     1     1      600            600         0      837            825
## 10  2013     1     1      602            605        -3      821            805
## # ... with 127,919 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Flew to Houston (IAH or HOU)</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-transformations.html#cb17-1"></a><span class="kw">filter</span>(flights, dest<span class="op">==</span><span class="st">&#39;HOU&#39;</span> <span class="op">|</span><span class="st"> </span>dest<span class="op">==</span><span class="st">&#39;IAH&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 9,313 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      623            627        -4      933            932
##  4  2013     1     1      728            732        -4     1041           1038
##  5  2013     1     1      739            739         0     1104           1038
##  6  2013     1     1      908            908         0     1228           1219
##  7  2013     1     1     1028           1026         2     1350           1339
##  8  2013     1     1     1044           1045        -1     1352           1351
##  9  2013     1     1     1114            900       134     1447           1222
## 10  2013     1     1     1205           1200         5     1503           1505
## # ... with 9,303 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Were operated by United, American, or Delta</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-transformations.html#cb19-1"></a><span class="co"># find out abbreviations for airlines</span></span>
<span id="cb19-2"><a href="data-transformations.html#cb19-2"></a><span class="co"># ?flights</span></span>
<span id="cb19-3"><a href="data-transformations.html#cb19-3"></a></span>
<span id="cb19-4"><a href="data-transformations.html#cb19-4"></a><span class="co"># airlines are stored in the airlines tibble</span></span>
<span id="cb19-5"><a href="data-transformations.html#cb19-5"></a>airlines</span></code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    carrier name                       
##    &lt;chr&gt;   &lt;chr&gt;                      
##  1 9E      Endeavor Air Inc.          
##  2 AA      American Airlines Inc.     
##  3 AS      Alaska Airlines Inc.       
##  4 B6      JetBlue Airways            
##  5 DL      Delta Air Lines Inc.       
##  6 EV      ExpressJet Airlines Inc.   
##  7 F9      Frontier Airlines Inc.     
##  8 FL      AirTran Airways Corporation
##  9 HA      Hawaiian Airlines Inc.     
## 10 MQ      Envoy Air                  
## 11 OO      SkyWest Airlines Inc.      
## 12 UA      United Air Lines Inc.      
## 13 US      US Airways Inc.            
## 14 VX      Virgin America             
## 15 WN      Southwest Airlines Co.     
## 16 YV      Mesa Airlines Inc.</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="data-transformations.html#cb21-1"></a><span class="co"># filter data frame with UA, AA, DL</span></span>
<span id="cb21-2"><a href="data-transformations.html#cb21-2"></a><span class="kw">filter</span>(flights, carrier <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;UA&#39;</span>, <span class="st">&#39;AA&#39;</span>, <span class="st">&#39;DL&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 139,504 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      554            600        -6      812            837
##  5  2013     1     1      554            558        -4      740            728
##  6  2013     1     1      558            600        -2      753            745
##  7  2013     1     1      558            600        -2      924            917
##  8  2013     1     1      558            600        -2      923            937
##  9  2013     1     1      559            600        -1      941            910
## 10  2013     1     1      559            600        -1      854            902
## # ... with 139,494 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Departed in summer (July, August, and September)</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data-transformations.html#cb23-1"></a><span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))</span></code></pre></div>
<pre><code>## # A tibble: 86,326 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     7     1        1           2029       212      236           2359
##  2  2013     7     1        2           2359         3      344            344
##  3  2013     7     1       29           2245       104      151              1
##  4  2013     7     1       43           2130       193      322             14
##  5  2013     7     1       44           2150       174      300            100
##  6  2013     7     1       46           2051       235      304           2358
##  7  2013     7     1       48           2001       287      308           2305
##  8  2013     7     1       58           2155       183      335             43
##  9  2013     7     1      100           2146       194      327             30
## 10  2013     7     1      100           2245       135      337            135
## # ... with 86,316 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Arrived more than two hours late, but didn’t leave late</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data-transformations.html#cb25-1"></a><span class="kw">filter</span>(flights, dep_delay<span class="op">&lt;=</span><span class="dv">0</span>, arr_delay<span class="op">&gt;</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 34,583 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      554            558        -4      740            728
##  2  2013     1     1      555            600        -5      913            854
##  3  2013     1     1      558            600        -2      753            745
##  4  2013     1     1      558            600        -2      924            917
##  5  2013     1     1      559            600        -1      941            910
##  6  2013     1     1      600            600         0      837            825
##  7  2013     1     1      602            605        -3      821            805
##  8  2013     1     1      622            630        -8     1017           1014
##  9  2013     1     1      624            630        -6      909            840
## 10  2013     1     1      624            630        -6      840            830
## # ... with 34,573 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Were delayed by at least an hour, but made up over 30 minutes in flight.</li>
</ol>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-transformations.html#cb27-1"></a><span class="kw">filter</span>(flights, dep_delay<span class="op">&gt;=</span><span class="dv">1</span>, dep_delay<span class="op">-</span>arr_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">30</span>)</span></code></pre></div>
<pre><code>## # A tibble: 8,974 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      701            700         1     1123           1154
##  2  2013     1     1      857            851         6     1157           1222
##  3  2013     1     1      909            810        59     1331           1315
##  4  2013     1     1     1025            951        34     1258           1302
##  5  2013     1     1     1625           1550        35     2054           2050
##  6  2013     1     1     1716           1545        91     2140           2039
##  7  2013     1     1     1900           1845        15     2212           2227
##  8  2013     1     1     1957           1945        12     2307           2329
##  9  2013     1     1     2035           2030         5     2337              5
## 10  2013     1     1     2046           2035        11     2144           2213
## # ... with 8,964 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Departed between midnight and 6am (inclusive)</li>
</ol>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-transformations.html#cb29-1"></a><span class="kw">filter</span>(flights, dep_time <span class="op">&lt;=</span><span class="st"> </span><span class="dv">600</span>)</span></code></pre></div>
<pre><code>## # A tibble: 9,344 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 9,334 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Another useful <code>dplyr</code> filtering helper is <code>between()</code>. What does it do? Can you use it to simplify the code needed to answer the previous challenges?</li>
</ol>
<p><code>between(x, left, right)</code> is a shortcut for <code>x &gt;= left</code> and <code>x &lt;= right</code>. We can definitely shorten part 4: departed in summer (between july and september)</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="data-transformations.html#cb31-1"></a><span class="co"># challenge 4</span></span>
<span id="cb31-2"><a href="data-transformations.html#cb31-2"></a><span class="kw">filter</span>(flights, <span class="kw">between</span>(month, <span class="dv">7</span>, <span class="dv">9</span>))</span></code></pre></div>
<pre><code>## # A tibble: 86,326 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     7     1        1           2029       212      236           2359
##  2  2013     7     1        2           2359         3      344            344
##  3  2013     7     1       29           2245       104      151              1
##  4  2013     7     1       43           2130       193      322             14
##  5  2013     7     1       44           2150       174      300            100
##  6  2013     7     1       46           2051       235      304           2358
##  7  2013     7     1       48           2001       287      308           2305
##  8  2013     7     1       58           2155       183      335             43
##  9  2013     7     1      100           2146       194      327             30
## 10  2013     7     1      100           2245       135      337            135
## # ... with 86,316 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>The rest are already simpler.</p>
<ol start="3" style="list-style-type: decimal">
<li>How many flights have a missing <code>dep_time</code>? What other variables are missing? What might these rows represent?</li>
</ol>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="data-transformations.html#cb33-1"></a>(no_dep &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, <span class="kw">is.na</span>(dep_time)))</span></code></pre></div>
<pre><code>## # A tibble: 8,255 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1       NA           1630        NA       NA           1815
##  2  2013     1     1       NA           1935        NA       NA           2240
##  3  2013     1     1       NA           1500        NA       NA           1825
##  4  2013     1     1       NA            600        NA       NA            901
##  5  2013     1     2       NA           1540        NA       NA           1747
##  6  2013     1     2       NA           1620        NA       NA           1746
##  7  2013     1     2       NA           1355        NA       NA           1459
##  8  2013     1     2       NA           1420        NA       NA           1644
##  9  2013     1     2       NA           1321        NA       NA           1536
## 10  2013     1     2       NA           1545        NA       NA           1910
## # ... with 8,245 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>There are 8,255 flights missing <code>dep_time</code>. These are missing <code>arr_time</code> and <code>air_time</code>. These may be flights that were canceled and never took off.</p>
<ol start="4" style="list-style-type: decimal">
<li>Why is <code>NA ^ 0</code> not missing? Why is <code>NA | TRUE</code> not missing? Why is <code>FALSE &amp; NA</code> not missing? Can you figure out the general rule? (<code>NA * 0</code> is a tricky counterexample!)</li>
</ol>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="data-transformations.html#cb35-1"></a><span class="ot">NA</span><span class="op">^</span><span class="dv">0</span> <span class="co"># = 1</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="data-transformations.html#cb37-1"></a><span class="ot">NA</span> <span class="op">|</span><span class="st"> </span><span class="ot">TRUE</span> <span class="co"># TRUE</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="data-transformations.html#cb39-1"></a><span class="ot">FALSE</span> <span class="op">&amp;</span><span class="st"> </span><span class="ot">NA</span> <span class="co"># FALSE</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="data-transformations.html#cb41-1"></a><span class="ot">NA</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span> <span class="co"># NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>We get a solution for the first three because no matter what value of the <code>NA</code> is, the solution will be the same. Imagine the <code>NA</code> was infinity in the first statement, then the answer is still 1. For the second statment <code>NA | TRUE</code>, we only need one side to be true and the entire is statement is true. Thus, it doesn’t matter what the NA value is. Then in the third statement <code>FALSE &amp; NA</code>, we need both sides to be true and since one is already FALSE, then the entire statement is false regardless of what the NA value is. Finally, the <code>NA * 0</code> statement doesn’t work because most of the time 0 times a number is 0, however if the NA were infinity, the answer is not zero.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="data-transformations.html#cb43-1"></a><span class="ot">Inf</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span></span></code></pre></div>
<pre><code>## [1] NaN</code></pre>
<p>This mean that we cannot get an answer for this statement.</p>
</div>
</div>
<div id="arrange-rows-with-arrange" class="section level2">
<h2><span class="header-section-number">5.3</span> Arrange rows with <code>arrange()</code></h2>
<p><code>arrange()</code> works similarly to <code>filter()</code> except it changes the order of the rows. It takes a data frame and a set of column names to order by. If you provide more than one column name, each additional column will be used to break ties in the values of the preceding column.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="data-transformations.html#cb45-1"></a><span class="kw">arrange</span>(flights, year, month, day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Use <code>desc()</code> to re-order a column in descending order.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="data-transformations.html#cb47-1"></a><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242           1530
##  2  2013     6    15     1432           1935      1137     1607           2120
##  3  2013     1    10     1121           1635      1126     1239           1810
##  4  2013     9    20     1139           1845      1014     1457           2210
##  5  2013     7    22      845           1600      1005     1044           1815
##  6  2013     4    10     1100           1900       960     1342           2211
##  7  2013     3    17     2321            810       911      135           1020
##  8  2013     6    27      959           1900       899     1236           2226
##  9  2013     7    22     2257            759       898      121           1026
## 10  2013    12     5      756           1700       896     1058           2020
## # ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Missing values are always sorted at the end.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="data-transformations.html#cb49-1"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">2</span>,<span class="ot">NA</span>))</span>
<span id="cb49-2"><a href="data-transformations.html#cb49-2"></a><span class="kw">arrange</span>(df, x)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 1
##       x
##   &lt;dbl&gt;
## 1     2
## 2     5
## 3    NA</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="data-transformations.html#cb51-1"></a><span class="kw">arrange</span>(df, <span class="kw">desc</span>(x))</span></code></pre></div>
<pre><code>## # A tibble: 3 x 1
##       x
##   &lt;dbl&gt;
## 1     5
## 2     2
## 3    NA</code></pre>
<div id="exercises-8" class="section level3">
<h3><span class="header-section-number">5.3.1</span> 5.3.1 Exercises</h3>
<ol style="list-style-type: decimal">
<li>How could you use <code>arrange()</code> to sort all missing values to the start? (Hint: use <code>is.na()</code>)</li>
</ol>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="data-transformations.html#cb53-1"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="ot">NA</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="ot">NA</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="ot">NA</span>))</span>
<span id="cb53-2"><a href="data-transformations.html#cb53-2"></a></span>
<span id="cb53-3"><a href="data-transformations.html#cb53-3"></a><span class="co"># sort in descending order, with is.na()</span></span>
<span id="cb53-4"><a href="data-transformations.html#cb53-4"></a><span class="kw">arrange</span>(df, <span class="kw">desc</span>(<span class="kw">is.na</span>(x)))</span></code></pre></div>
<pre><code>## # A tibble: 8 x 1
##       x
##   &lt;dbl&gt;
## 1    NA
## 2    NA
## 3    NA
## 4     1
## 5     2
## 6     3
## 7     4
## 8     5</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Sort <code>flights</code> to find the most delayed flights. Find the flights that left earliest.</li>
</ol>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="data-transformations.html#cb55-1"></a><span class="co"># sort the departure delays in descending order</span></span>
<span id="cb55-2"><a href="data-transformations.html#cb55-2"></a><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242           1530
##  2  2013     6    15     1432           1935      1137     1607           2120
##  3  2013     1    10     1121           1635      1126     1239           1810
##  4  2013     9    20     1139           1845      1014     1457           2210
##  5  2013     7    22      845           1600      1005     1044           1815
##  6  2013     4    10     1100           1900       960     1342           2211
##  7  2013     3    17     2321            810       911      135           1020
##  8  2013     6    27      959           1900       899     1236           2226
##  9  2013     7    22     2257            759       898      121           1026
## 10  2013    12     5      756           1700       896     1058           2020
## # ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Sort <code>flights</code> to find the fastest (highest speed) flights.</li>
</ol>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="data-transformations.html#cb57-1"></a><span class="co"># sort by distance traveled divided by time spent in the air</span></span>
<span id="cb57-2"><a href="data-transformations.html#cb57-2"></a><span class="kw">arrange</span>(flights, distance<span class="op">/</span>air_time)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1    28     1917           1825        52     2118           1935
##  2  2013     6    29      755            800        -5     1035            909
##  3  2013     8    28      932            940        -8     1116           1051
##  4  2013     1    30     1037            955        42     1221           1100
##  5  2013    11    27      556            600        -4      727            658
##  6  2013     5    21      558            600        -2      721            657
##  7  2013    12     9     1540           1535         5     1720           1656
##  8  2013     6    10     1356           1300        56     1646           1414
##  9  2013     7    28     1322           1325        -3     1612           1432
## 10  2013     4    11     1349           1345         4     1542           1453
## # ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Which flights travelled the farthest? Which travelled the shortest?</li>
</ol>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="data-transformations.html#cb59-1"></a><span class="co"># sort by distance for shortest flights</span></span>
<span id="cb59-2"><a href="data-transformations.html#cb59-2"></a><span class="kw">arrange</span>(flights, distance)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     7    27       NA            106        NA       NA            245
##  2  2013     1     3     2127           2129        -2     2222           2224
##  3  2013     1     4     1240           1200        40     1333           1306
##  4  2013     1     4     1829           1615       134     1937           1721
##  5  2013     1     4     2128           2129        -1     2218           2224
##  6  2013     1     5     1155           1200        -5     1241           1306
##  7  2013     1     6     2125           2129        -4     2224           2224
##  8  2013     1     7     2124           2129        -5     2212           2224
##  9  2013     1     8     2127           2130        -3     2304           2225
## 10  2013     1     9     2126           2129        -3     2217           2224
## # ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="data-transformations.html#cb61-1"></a><span class="co"># sort by descending distance for farthest flights</span></span>
<span id="cb61-2"><a href="data-transformations.html#cb61-2"></a><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(distance))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      857            900        -3     1516           1530
##  2  2013     1     2      909            900         9     1525           1530
##  3  2013     1     3      914            900        14     1504           1530
##  4  2013     1     4      900            900         0     1516           1530
##  5  2013     1     5      858            900        -2     1519           1530
##  6  2013     1     6     1019            900        79     1558           1530
##  7  2013     1     7     1042            900       102     1620           1530
##  8  2013     1     8      901            900         1     1504           1530
##  9  2013     1     9      641            900      1301     1242           1530
## 10  2013     1    10      859            900        -1     1449           1530
## # ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<div id="selection-columns-with-select" class="section level2">
<h2><span class="header-section-number">5.4</span> Selection columns with <code>select()</code></h2>
<p><code>select()</code> allows you to zoom in on a useful subset of columns using operations baed on the names of the variables.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="data-transformations.html#cb63-1"></a><span class="co"># select columns by names</span></span>
<span id="cb63-2"><a href="data-transformations.html#cb63-2"></a>dplyr<span class="op">::</span><span class="kw">select</span>(flights, year, month, day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="data-transformations.html#cb65-1"></a><span class="co"># select all columns between year and day</span></span>
<span id="cb65-2"><a href="data-transformations.html#cb65-2"></a>dplyr<span class="op">::</span><span class="kw">select</span>(flights, year<span class="op">:</span>day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="data-transformations.html#cb67-1"></a><span class="co"># select all columns except for those from year to day (inclusive)</span></span>
<span id="cb67-2"><a href="data-transformations.html#cb67-2"></a><span class="kw">select</span>(flights, <span class="op">-</span>(year<span class="op">:</span>day))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  
##  1      517            515         2      830            819        11 UA     
##  2      533            529         4      850            830        20 UA     
##  3      542            540         2      923            850        33 AA     
##  4      544            545        -1     1004           1022       -18 B6     
##  5      554            600        -6      812            837       -25 DL     
##  6      554            558        -4      740            728        12 UA     
##  7      555            600        -5      913            854        19 B6     
##  8      557            600        -3      709            723       -14 EV     
##  9      557            600        -3      838            846        -8 B6     
## 10      558            600        -2      753            745         8 AA     
## # ... with 336,766 more rows, and 9 more variables: flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>There are some other useful helper functions that you can use with <code>select()</code>:</p>
<ul>
<li><code>starts_with(abc)</code> matches names that begin with “abc”</li>
<li><code>ends_with(xyz)</code> matches names that end with “xyz”</li>
<li>`contains(“ijk”) matches names that contain “ijk”</li>
<li>`matches(“(.)\1”) selects variables that match a regular expression. This one matches any variables that contain repeated characters.</li>
<li><code>num_range("x", 1:3)</code> matches <code>x1</code>, <code>x2</code>, <code>x3</code></li>
</ul>
<p>Se more in <code>?select</code></p>
<p><code>select()</code> can also be used to rename variables, but is rarely useful because it drops all of the variables not explicitly mentioned. Instead, use <code>rename()</code>, a variant of <code>select()</code> that keeps all the variables that aren’t explicitly mentioned.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="data-transformations.html#cb69-1"></a><span class="kw">rename</span>(flights, <span class="dt">date=</span>day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month  date dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Another option is to use <code>select()</code> with <code>everything()</code>. This is useful if you have a handful of variables that you’d like to move to the start of the data frame.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="data-transformations.html#cb71-1"></a><span class="kw">select</span>(flights, time_hour, air_time, <span class="kw">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##    time_hour           air_time  year month   day dep_time sched_dep_time
##    &lt;dttm&gt;                 &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
##  1 2013-01-01 05:00:00      227  2013     1     1      517            515
##  2 2013-01-01 05:00:00      227  2013     1     1      533            529
##  3 2013-01-01 05:00:00      160  2013     1     1      542            540
##  4 2013-01-01 05:00:00      183  2013     1     1      544            545
##  5 2013-01-01 06:00:00      116  2013     1     1      554            600
##  6 2013-01-01 05:00:00      150  2013     1     1      554            558
##  7 2013-01-01 06:00:00      158  2013     1     1      555            600
##  8 2013-01-01 06:00:00       53  2013     1     1      557            600
##  9 2013-01-01 06:00:00      140  2013     1     1      557            600
## 10 2013-01-01 06:00:00      138  2013     1     1      558            600
## # ... with 336,766 more rows, and 12 more variables: dep_delay &lt;dbl&gt;,
## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;</code></pre>
<div id="exercises-9" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>Brainstorm as many ways as possible to select <code>dep_time</code>, <code>dep_delay</code>, <code>air_time</code>, and <code>arr_delay</code> from `flights.</li>
</ol>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="data-transformations.html#cb73-1"></a><span class="co"># using select()</span></span>
<span id="cb73-2"><a href="data-transformations.html#cb73-2"></a><span class="kw">select</span>(flights, dep_time, dep_delay, arr_time, arr_delay)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="data-transformations.html#cb75-1"></a><span class="co"># using select() with helper function starts_with()</span></span>
<span id="cb75-2"><a href="data-transformations.html#cb75-2"></a><span class="kw">select</span>(flights, <span class="kw">starts_with</span>(<span class="st">&quot;dep&quot;</span>), <span class="kw">starts_with</span>(<span class="st">&quot;arr&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="data-transformations.html#cb77-1"></a><span class="co"># use select() with ends_with() and starts_with()</span></span>
<span id="cb77-2"><a href="data-transformations.html#cb77-2"></a><span class="kw">select</span>(flights, <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), <span class="kw">ends_with</span>(<span class="st">&quot;time&quot;</span>), <span class="op">-</span><span class="kw">starts_with</span>(<span class="kw">c</span>(<span class="st">&quot;sched&quot;</span>, <span class="st">&quot;air&quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_delay arr_delay dep_time arr_time
##        &lt;dbl&gt;     &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;
##  1         2        11      517      830
##  2         4        20      533      850
##  3         2        33      542      923
##  4        -1       -18      544     1004
##  5        -6       -25      554      812
##  6        -4        12      554      740
##  7        -5        19      555      913
##  8        -3       -14      557      709
##  9        -3        -8      557      838
## 10        -2         8      558      753
## # ... with 336,766 more rows</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>What happens if you include the name of a variable multiple times in a <code>select()</code> call?</li>
</ol>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="data-transformations.html#cb79-1"></a><span class="kw">select</span>(flights, year, year)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##     year
##    &lt;int&gt;
##  1  2013
##  2  2013
##  3  2013
##  4  2013
##  5  2013
##  6  2013
##  7  2013
##  8  2013
##  9  2013
## 10  2013
## # ... with 336,766 more rows</code></pre>
<p>If you include a variable multiple times in select, the variables will only be selected once.</p>
<ol start="3" style="list-style-type: decimal">
<li>What does the <code>any_of()</code> function do? Why might it be helpful in conjunction with this vector?</li>
</ol>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="data-transformations.html#cb81-1"></a>vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;dep_delay&quot;</span>, <span class="st">&quot;arr_delay&quot;</span>)</span></code></pre></div>
<p>The <code>any_of()</code> function will select any of the columns using a vector. As opposed to the <code>all_of()</code> function, <code>any_of()</code> will not throw an error if the vector contains names that are not found as columns in the data frame.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="data-transformations.html#cb82-1"></a><span class="kw">select</span>(flights, <span class="kw">any_of</span>(vars))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 5
##     year month   day dep_delay arr_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1  2013     1     1         2        11
##  2  2013     1     1         4        20
##  3  2013     1     1         2        33
##  4  2013     1     1        -1       -18
##  5  2013     1     1        -6       -25
##  6  2013     1     1        -4        12
##  7  2013     1     1        -5        19
##  8  2013     1     1        -3       -14
##  9  2013     1     1        -3        -8
## 10  2013     1     1        -2         8
## # ... with 336,766 more rows</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Does the result of running the following code suprise you? How do the select helpers deal with case by default? How can you change the default?</li>
</ol>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="data-transformations.html#cb84-1"></a><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##    dep_time sched_dep_time arr_time sched_arr_time air_time time_hour          
##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt; &lt;dttm&gt;             
##  1      517            515      830            819      227 2013-01-01 05:00:00
##  2      533            529      850            830      227 2013-01-01 05:00:00
##  3      542            540      923            850      160 2013-01-01 05:00:00
##  4      544            545     1004           1022      183 2013-01-01 05:00:00
##  5      554            600      812            837      116 2013-01-01 06:00:00
##  6      554            558      740            728      150 2013-01-01 05:00:00
##  7      555            600      913            854      158 2013-01-01 06:00:00
##  8      557            600      709            723       53 2013-01-01 06:00:00
##  9      557            600      838            846      140 2013-01-01 06:00:00
## 10      558            600      753            745      138 2013-01-01 06:00:00
## # ... with 336,766 more rows</code></pre>
<p>The helpers ignore case by default. To change this behaviour we can use the <code>ignore.case</code> argument.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="data-transformations.html#cb86-1"></a><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>, <span class="dt">ignore.case=</span><span class="ot">FALSE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 0</code></pre>
</div>
</div>
<div id="add-new-variables-with-mutate" class="section level2">
<h2><span class="header-section-number">5.5</span> Add new variables with <code>mutate()</code></h2>
<p>We can add new columns that are functions of existing columns using <code>mutate()</code>. This will add new columns at the end of the dataset.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="data-transformations.html#cb88-1"></a><span class="co"># create a dataframe with less columns</span></span>
<span id="cb88-2"><a href="data-transformations.html#cb88-2"></a>flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, year<span class="op">:</span>day, <span class="kw">ends_with</span>(<span class="st">&#39;delay&#39;</span>), distance, air_time)</span>
<span id="cb88-3"><a href="data-transformations.html#cb88-3"></a></span>
<span id="cb88-4"><a href="data-transformations.html#cb88-4"></a><span class="co"># add new columns with mutate()</span></span>
<span id="cb88-5"><a href="data-transformations.html#cb88-5"></a><span class="kw">mutate</span>(flights_sml, </span>
<span id="cb88-6"><a href="data-transformations.html#cb88-6"></a>       <span class="dt">gain =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay,</span>
<span id="cb88-7"><a href="data-transformations.html#cb88-7"></a>       <span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>air_time <span class="op">*</span><span class="st"> </span><span class="dv">60</span>)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 9
##     year month   day dep_delay arr_delay distance air_time  gain speed
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227    -9  370.
##  2  2013     1     1         4        20     1416      227   -16  374.
##  3  2013     1     1         2        33     1089      160   -31  408.
##  4  2013     1     1        -1       -18     1576      183    17  517.
##  5  2013     1     1        -6       -25      762      116    19  394.
##  6  2013     1     1        -4        12      719      150   -16  288.
##  7  2013     1     1        -5        19     1065      158   -24  404.
##  8  2013     1     1        -3       -14      229       53    11  259.
##  9  2013     1     1        -3        -8      944      140     5  405.
## 10  2013     1     1        -2         8      733      138   -10  319.
## # ... with 336,766 more rows</code></pre>
<p>Note that you can refere to the columns that you just created.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="data-transformations.html#cb90-1"></a><span class="kw">mutate</span>(flights_sml,</span>
<span id="cb90-2"><a href="data-transformations.html#cb90-2"></a>       <span class="dt">gain =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay,</span>
<span id="cb90-3"><a href="data-transformations.html#cb90-3"></a>       <span class="dt">hours =</span> air_time <span class="op">/</span><span class="st"> </span><span class="dv">60</span>,</span>
<span id="cb90-4"><a href="data-transformations.html#cb90-4"></a>       <span class="dt">gain_per_hour =</span> gain <span class="op">/</span><span class="st"> </span>hours)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 10
##     year month   day dep_delay arr_delay distance air_time  gain hours
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227    -9 3.78 
##  2  2013     1     1         4        20     1416      227   -16 3.78 
##  3  2013     1     1         2        33     1089      160   -31 2.67 
##  4  2013     1     1        -1       -18     1576      183    17 3.05 
##  5  2013     1     1        -6       -25      762      116    19 1.93 
##  6  2013     1     1        -4        12      719      150   -16 2.5  
##  7  2013     1     1        -5        19     1065      158   -24 2.63 
##  8  2013     1     1        -3       -14      229       53    11 0.883
##  9  2013     1     1        -3        -8      944      140     5 2.33 
## 10  2013     1     1        -2         8      733      138   -10 2.3  
## # ... with 336,766 more rows, and 1 more variable: gain_per_hour &lt;dbl&gt;</code></pre>
<p>If you only want to keep the new variables, use <code>transmute()</code>.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="data-transformations.html#cb92-1"></a><span class="kw">transmute</span>(flights, </span>
<span id="cb92-2"><a href="data-transformations.html#cb92-2"></a>          <span class="dt">gain =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay,</span>
<span id="cb92-3"><a href="data-transformations.html#cb92-3"></a>          <span class="dt">hours =</span> air_time <span class="op">/</span><span class="st"> </span><span class="dv">60</span>,</span>
<span id="cb92-4"><a href="data-transformations.html#cb92-4"></a>          <span class="dt">gain_per_hour =</span> gain <span class="op">/</span><span class="st"> </span>hours)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     gain hours gain_per_hour
##    &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1    -9 3.78          -2.38
##  2   -16 3.78          -4.23
##  3   -31 2.67         -11.6 
##  4    17 3.05           5.57
##  5    19 1.93           9.83
##  6   -16 2.5           -6.4 
##  7   -24 2.63          -9.11
##  8    11 0.883         12.5 
##  9     5 2.33           2.14
## 10   -10 2.3           -4.35
## # ... with 336,766 more rows</code></pre>
<div id="useful-creation-functions" class="section level3">
<h3><span class="header-section-number">5.5.1</span> Useful creation functions</h3>
<p><a id="top"></a></p>
<p>There are many functions you might use with the <code>mutate()</code> function. Here are some useful ones.</p>
<ul>
<li>arithmetic operators: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code></li>
<li>modular arithmentic: <code>%/%</code> (integer division) and <code>%%</code> (remainder)</li>
<li>logs: <code>log()</code>, <code>log2()</code>, <code>log10()</code></li>
<li>offsets: <code>lead()</code> and <code>lag()</code> allow you to refer to the leading or lagging values.</li>
</ul>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="data-transformations.html#cb94-1"></a>(x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="data-transformations.html#cb96-1"></a><span class="kw">lag</span>(x)</span></code></pre></div>
<pre><code>##  [1] NA  1  2  3  4  5  6  7  8  9</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="data-transformations.html#cb98-1"></a><span class="kw">lead</span>(x)</span></code></pre></div>
<pre><code>##  [1]  2  3  4  5  6  7  8  9 10 NA</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="data-transformations.html#cb100-1"></a><span class="co"># use this to compute runnign differences</span></span>
<span id="cb100-2"><a href="data-transformations.html#cb100-2"></a>x<span class="op">-</span><span class="kw">lag</span>(x)</span></code></pre></div>
<pre><code>##  [1] NA  1  1  1  1  1  1  1  1  1</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="data-transformations.html#cb102-1"></a><span class="co"># find when value changes</span></span>
<span id="cb102-2"><a href="data-transformations.html#cb102-2"></a>x <span class="op">!=</span><span class="st"> </span><span class="kw">lag</span>(x)</span></code></pre></div>
<pre><code>##  [1]   NA TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</code></pre>
<ul>
<li>cumulative and rolling aggregates: <code>cumsum()</code> (cumulative sum), <code>cumprod()</code> (cumulative product), <code>cummin()</code> (cumulative min), <code>cummax()</code> (cumulative max), <code>cummean()</code> (cumulative mean).</li>
</ul>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="data-transformations.html#cb104-1"></a>x</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="data-transformations.html#cb106-1"></a><span class="kw">cumsum</span>(x)</span></code></pre></div>
<pre><code>##  [1]  1  3  6 10 15 21 28 36 45 55</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="data-transformations.html#cb108-1"></a><span class="kw">cumprod</span>(x)</span></code></pre></div>
<pre><code>##  [1]       1       2       6      24     120     720    5040   40320  362880
## [10] 3628800</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="data-transformations.html#cb110-1"></a><span class="kw">cummin</span>(x)</span></code></pre></div>
<pre><code>##  [1] 1 1 1 1 1 1 1 1 1 1</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="data-transformations.html#cb112-1"></a><span class="kw">cummax</span>(x)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="data-transformations.html#cb114-1"></a><span class="kw">cummean</span>(x)</span></code></pre></div>
<pre><code>##  [1] 1.0 1.5 2.0 2.5 3.0 3.5 4.0 4.5 5.0 5.5</code></pre>
<ul>
<li>logical comparisons: <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>!=</code>, <code>==</code></li>
<li>ranking</li>
</ul>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="data-transformations.html#cb116-1"></a>y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="ot">NA</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb116-2"><a href="data-transformations.html#cb116-2"></a></span>
<span id="cb116-3"><a href="data-transformations.html#cb116-3"></a><span class="co"># rank in order</span></span>
<span id="cb116-4"><a href="data-transformations.html#cb116-4"></a><span class="kw">min_rank</span>(y)</span></code></pre></div>
<pre><code>## [1]  1  2  2 NA  4  5</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="data-transformations.html#cb118-1"></a><span class="co"># rank in reverse order</span></span>
<span id="cb118-2"><a href="data-transformations.html#cb118-2"></a><span class="kw">min_rank</span>(<span class="kw">desc</span>(y))</span></code></pre></div>
<pre><code>## [1]  5  3  3 NA  2  1</code></pre>
<p>Here are some variants of the standard ranks.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="data-transformations.html#cb120-1"></a><span class="kw">row_number</span>(y)</span></code></pre></div>
<pre><code>## [1]  1  2  3 NA  4  5</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="data-transformations.html#cb122-1"></a><span class="kw">dense_rank</span>(y)</span></code></pre></div>
<pre><code>## [1]  1  2  2 NA  3  4</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="data-transformations.html#cb124-1"></a><span class="kw">percent_rank</span>(y)</span></code></pre></div>
<pre><code>## [1] 0.00 0.25 0.25   NA 0.75 1.00</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="data-transformations.html#cb126-1"></a><span class="kw">cume_dist</span>(y)</span></code></pre></div>
<pre><code>## [1] 0.2 0.6 0.6  NA 0.8 1.0</code></pre>
</div>
<div id="exercises-10" class="section level3">
<h3><span class="header-section-number">5.5.2</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>Currently <code>dep_time</code> and <code>sched_dep_time</code> are convenient to look at, but hard to compute with because they’re not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.</li>
</ol>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="data-transformations.html#cb128-1"></a><span class="co"># make a smaller data frame</span></span>
<span id="cb128-2"><a href="data-transformations.html#cb128-2"></a>flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, dep_time, sched_dep_time)</span>
<span id="cb128-3"><a href="data-transformations.html#cb128-3"></a></span>
<span id="cb128-4"><a href="data-transformations.html#cb128-4"></a><span class="co"># multiply hours by 60 and add to minutes</span></span>
<span id="cb128-5"><a href="data-transformations.html#cb128-5"></a><span class="co"># time is formatted as HHMM or HMM</span></span>
<span id="cb128-6"><a href="data-transformations.html#cb128-6"></a><span class="kw">mutate</span>(flights_sml,</span>
<span id="cb128-7"><a href="data-transformations.html#cb128-7"></a>       <span class="dt">new_dep_time =</span> dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb128-8"><a href="data-transformations.html#cb128-8"></a>       <span class="dt">new_sched_dep_time =</span> sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb128-9"><a href="data-transformations.html#cb128-9"></a>       )</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time sched_dep_time new_dep_time new_sched_dep_time
##       &lt;int&gt;          &lt;int&gt;        &lt;dbl&gt;              &lt;dbl&gt;
##  1      517            515          317                315
##  2      533            529          333                329
##  3      542            540          342                340
##  4      544            545          344                345
##  5      554            600          354                360
##  6      554            558          354                358
##  7      555            600          355                360
##  8      557            600          357                360
##  9      557            600          357                360
## 10      558            600          358                360
## # ... with 336,766 more rows</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Compare <code>air_time</code> with <code>arr_time - dep_time</code>. What do you expect to see? What do you see? What do you need to do to fix it?</li>
</ol>
<p>I would expect to see the duration of the flight.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="data-transformations.html#cb130-1"></a>flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, arr_time, dep_time, air_time)</span>
<span id="cb130-2"><a href="data-transformations.html#cb130-2"></a></span>
<span id="cb130-3"><a href="data-transformations.html#cb130-3"></a><span class="kw">mutate</span>(flights_sml,</span>
<span id="cb130-4"><a href="data-transformations.html#cb130-4"></a>       <span class="dt">duration =</span> arr_time <span class="op">-</span><span class="st"> </span>dep_time)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    arr_time dep_time air_time duration
##       &lt;int&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;
##  1      830      517      227      313
##  2      850      533      227      317
##  3      923      542      160      381
##  4     1004      544      183      460
##  5      812      554      116      258
##  6      740      554      150      186
##  7      913      555      158      358
##  8      709      557       53      152
##  9      838      557      140      281
## 10      753      558      138      195
## # ... with 336,766 more rows</code></pre>
<p>The computed duration doesn’t match the <code>air_time</code> in the table. This format doesn’t allow us to do a subtraction because it’s written in HMM format. We can convert to minutes like we did previously. These times are also recorded in the local timezone, so need to take this into account to get an accurate flight duration.</p>
<ol start="3" style="list-style-type: decimal">
<li>Compare <code>dep_time</code>, <code>sched_dep_time</code>, and <code>dep_delay</code>. How would you expect those three numbers to be related?</li>
</ol>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="data-transformations.html#cb132-1"></a><span class="kw">select</span>(flights, dep_time, sched_dep_time, dep_delay)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##    dep_time sched_dep_time dep_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1      517            515         2
##  2      533            529         4
##  3      542            540         2
##  4      544            545        -1
##  5      554            600        -6
##  6      554            558        -4
##  7      555            600        -5
##  8      557            600        -3
##  9      557            600        -3
## 10      558            600        -2
## # ... with 336,766 more rows</code></pre>
<p>I would expect that <code>dep_delay</code> is the result of subtracting <code>sched_dep_time</code> from <code>dep_time</code>. We can add a column to verify this.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="data-transformations.html#cb134-1"></a><span class="kw">mutate</span>(<span class="kw">select</span>(flights, dep_time, sched_dep_time, dep_delay), </span>
<span id="cb134-2"><a href="data-transformations.html#cb134-2"></a>       <span class="dt">difference =</span> dep_time <span class="op">-</span><span class="st"> </span>sched_dep_time)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time sched_dep_time dep_delay difference
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;      &lt;int&gt;
##  1      517            515         2          2
##  2      533            529         4          4
##  3      542            540         2          2
##  4      544            545        -1         -1
##  5      554            600        -6        -46
##  6      554            558        -4         -4
##  7      555            600        -5        -45
##  8      557            600        -3        -43
##  9      557            600        -3        -43
## 10      558            600        -2        -42
## # ... with 336,766 more rows</code></pre>
<p>It looks like the calculation works for determing <code>dep_delay</code> from the other two columns.</p>
<ol start="4" style="list-style-type: decimal">
<li>Find the 10 most delayed flights using a ranking function. How do you want to handle ties? Carefuly read the documnetation for <code>min_rank()</code>.</li>
</ol>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="data-transformations.html#cb136-1"></a><span class="co"># add column for min rank</span></span>
<span id="cb136-2"><a href="data-transformations.html#cb136-2"></a><span class="co"># filter by min rank column</span></span>
<span id="cb136-3"><a href="data-transformations.html#cb136-3"></a><span class="co"># sort by the rank column</span></span>
<span id="cb136-4"><a href="data-transformations.html#cb136-4"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb136-5"><a href="data-transformations.html#cb136-5"></a><span class="st">   </span><span class="kw">mutate</span>(flights, <span class="dt">dep_rank=</span><span class="kw">min_rank</span>(dep_delay)) <span class="op">%&gt;%</span></span>
<span id="cb136-6"><a href="data-transformations.html#cb136-6"></a><span class="st">  </span><span class="kw">filter</span>(dep_rank <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb136-7"><a href="data-transformations.html#cb136-7"></a><span class="st">  </span><span class="kw">arrange</span>(dep_rank)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013    12     7     2040           2123       -43       40           2352
##  2  2013     2     3     2022           2055       -33     2240           2338
##  3  2013    11    10     1408           1440       -32     1549           1559
##  4  2013     1    11     1900           1930       -30     2233           2243
##  5  2013     1    29     1703           1730       -27     1947           1957
##  6  2013     8     9      729            755       -26     1002            955
##  7  2013    10    23     1907           1932       -25     2143           2143
##  8  2013     3    30     2030           2055       -25     2213           2250
##  9  2013     3     2     1431           1455       -24     1601           1631
## 10  2013     5     5      934            958       -24     1225           1309
## 11  2013     5    14      914            938       -24     1143           1204
## 12  2013     9    18     1631           1655       -24     1812           1845
## # ... with 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, dep_rank &lt;int&gt;</code></pre>
<p><code>min_rank()</code> does not break ties, but instead assigned the same rank to equal values. We could also use <code>row_number()</code> which breaks ties by giving a lower rank to the value that is encountered first. We can try <code>row_number()</code> and see how the answer changes.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="data-transformations.html#cb138-1"></a><span class="co"># add column for row_number()</span></span>
<span id="cb138-2"><a href="data-transformations.html#cb138-2"></a><span class="co"># filter by row_number column</span></span>
<span id="cb138-3"><a href="data-transformations.html#cb138-3"></a><span class="co"># sort by the row_number column</span></span>
<span id="cb138-4"><a href="data-transformations.html#cb138-4"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb138-5"><a href="data-transformations.html#cb138-5"></a><span class="st">  </span><span class="kw">mutate</span>(flights, <span class="dt">dep_rank=</span><span class="kw">row_number</span>(dep_delay)) <span class="op">%&gt;%</span></span>
<span id="cb138-6"><a href="data-transformations.html#cb138-6"></a><span class="st">  </span><span class="kw">filter</span>(dep_rank <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb138-7"><a href="data-transformations.html#cb138-7"></a><span class="st">  </span><span class="kw">arrange</span>(dep_rank)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013    12     7     2040           2123       -43       40           2352
##  2  2013     2     3     2022           2055       -33     2240           2338
##  3  2013    11    10     1408           1440       -32     1549           1559
##  4  2013     1    11     1900           1930       -30     2233           2243
##  5  2013     1    29     1703           1730       -27     1947           1957
##  6  2013     8     9      729            755       -26     1002            955
##  7  2013    10    23     1907           1932       -25     2143           2143
##  8  2013     3    30     2030           2055       -25     2213           2250
##  9  2013     3     2     1431           1455       -24     1601           1631
## 10  2013     5     5      934            958       -24     1225           1309
## # ... with 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, dep_rank &lt;int&gt;</code></pre>
<p>Now we have exactly 10 flights since we broke ties with the <code>row_number()</code> function, whereas we had 12 flights using the <code>min_rank()</code> function. Depending on our needs, we might prefer one method over the other.</p>
<ol start="5" style="list-style-type: decimal">
<li>What does <code>1:3 + 1:10</code> return? Why?</li>
</ol>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="data-transformations.html#cb140-1"></a><span class="co"># 1:3 + 1:10</span></span></code></pre></div>
<p>We get an error when we try to run this, saying that the longer object length is not a multiple of shorter object length. <code>R</code> is trying to apply the vector addition by vectorizing the input but does not know how. We can try to fix this by making the longer vector’s length a multiple of the shorter vector length.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="data-transformations.html#cb141-1"></a><span class="dv">1</span><span class="op">:</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span></span></code></pre></div>
<pre><code>##  [1]  2  4  6  5  7  9  8 10 12 11 13 15</code></pre>
<p>Now we get the vector <code>1:12</code> with the vector <code>1:3</code> repeated 4 times, and added across the 12 numbers. The shorter vector was repeated to make the length of the longer vector to complete the addition operation. This is similar to adding a scalar to a vector and having the scalar become a vectorized version of itself.</p>
<ol start="6" style="list-style-type: decimal">
<li>What trigonometric functions does R provide?</li>
</ol>
<p>You can access the trigonometric functions documentation by typing <code>?Trig</code>. R provides the following trig functions:</p>
<ul>
<li><code>cos(x)</code></li>
<li><code>sin(x)</code></li>
<li><code>tan(x)</code></li>
<li><code>acos(x)</code></li>
<li><code>asin(x)</code></li>
<li><code>atan(x)</code></li>
<li><code>atan2(y,x)</code></li>
<li><code>cospi(x)</code></li>
<li><code>sinpi(x)</code></li>
<li><code>tanpi(x)</code></li>
</ul>
</div>
</div>
<div id="grouped-summaries-with-summarise" class="section level2">
<h2><span class="header-section-number">5.6</span> 5.6 Grouped summaries with <code>summarise()</code></h2>
<p>The last key verb is <code>summarise()</code>. It collapses a dataframe to a single row.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="data-transformations.html#cb143-1"></a><span class="kw">summarise</span>(flights, <span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   delay
##   &lt;dbl&gt;
## 1  12.6</code></pre>
<p><code>summarise()</code> is more usefule when paired with <code>group_by()</code>. This changes the unit of analysis from the entire dataframe to the individual groups. We can apply the same function to the grouped dataframe to get the average delay per date.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="data-transformations.html#cb145-1"></a><span class="kw">group_by</span>(flights, year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb145-2"><a href="data-transformations.html#cb145-2"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.5 
##  2  2013     1     2 13.9 
##  3  2013     1     3 11.0 
##  4  2013     1     4  8.95
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.55
##  9  2013     1     9  2.28
## 10  2013     1    10  2.84
## # ... with 355 more rows</code></pre>
<div id="combining-multiple-operations-with-the-pipe" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Combining multiple operations with the pipe</h3>
<p>Not going to go through this. See R4ds book online.</p>
</div>
<div id="missing-values-1" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Missing values</h3>
<p>The <code>na.rm</code> flag is used to remove NA values before the computation. Alternatively, we can filter the NA values out of the dataframe prior to summarizing.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="data-transformations.html#cb148-1"></a>not_cancelled &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></span>
<span id="cb148-2"><a href="data-transformations.html#cb148-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay), <span class="op">!</span><span class="kw">is.na</span>(arr_delay))</span>
<span id="cb148-3"><a href="data-transformations.html#cb148-3"></a></span>
<span id="cb148-4"><a href="data-transformations.html#cb148-4"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb148-5"><a href="data-transformations.html#cb148-5"></a><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb148-6"><a href="data-transformations.html#cb148-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.4 
##  2  2013     1     2 13.7 
##  3  2013     1     3 10.9 
##  4  2013     1     4  8.97
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.56
##  9  2013     1     9  2.30
## 10  2013     1    10  2.84
## # ... with 355 more rows</code></pre>
</div>
<div id="counts" class="section level3">
<h3><span class="header-section-number">5.6.3</span> Counts</h3>
<p>Whenever you do any aggregation, it’s always a good idea to include either a count (<code>n()</code>) or a count of non-missing values (<code>sum(is.na(x))</code>). That way you can check that you’re not drawing conclusions based on very small amounts of data. For example, let’s look at the planes that have the highest average delays.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="data-transformations.html#cb151-1"></a>delays &lt;-<span class="st"> </span>not_cancelled <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb151-2"><a href="data-transformations.html#cb151-2"></a><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></span>
<span id="cb151-3"><a href="data-transformations.html#cb151-3"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb151-4"><a href="data-transformations.html#cb151-4"></a>    <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay)</span>
<span id="cb151-5"><a href="data-transformations.html#cb151-5"></a>  )</span>
<span id="cb151-6"><a href="data-transformations.html#cb151-6"></a></span>
<span id="cb151-7"><a href="data-transformations.html#cb151-7"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> delays, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> delay)) <span class="op">+</span></span>
<span id="cb151-8"><a href="data-transformations.html#cb151-8"></a><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="R4DS_bookdown_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<p>We get more information if we draw a scatterplot of number of flights vs. average delay.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="data-transformations.html#cb152-1"></a>delays &lt;-<span class="st"> </span>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb152-2"><a href="data-transformations.html#cb152-2"></a><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></span>
<span id="cb152-3"><a href="data-transformations.html#cb152-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb152-4"><a href="data-transformations.html#cb152-4"></a>    <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb152-5"><a href="data-transformations.html#cb152-5"></a>    <span class="dt">n =</span> <span class="kw">n</span>()</span>
<span id="cb152-6"><a href="data-transformations.html#cb152-6"></a>  )</span>
<span id="cb152-7"><a href="data-transformations.html#cb152-7"></a></span>
<span id="cb152-8"><a href="data-transformations.html#cb152-8"></a></span>
<span id="cb152-9"><a href="data-transformations.html#cb152-9"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> delays, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x=</span>n, <span class="dt">y =</span> delay)) <span class="op">+</span></span>
<span id="cb152-10"><a href="data-transformations.html#cb152-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="R4DS_bookdown_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>Now we see that there is much greater variation in the average delay when there are few flights. Typicaly, when you plot a mean (or other summary) vs. group size, you’ll see the variation decreases as the sample size increases.</p>
<p>When looking at this type of plot, it’s often useful to filter out the groups with the smallest numbers of observations, so you can see more of the pattern and less of the extreme variation in the smallest groups. This is what the following code does, as well as showing you a handy pattern for integrating ggplot2 into dplyr flows.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="data-transformations.html#cb153-1"></a>delays <span class="op">%&gt;%</span></span>
<span id="cb153-2"><a href="data-transformations.html#cb153-2"></a><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">25</span>) <span class="op">%&gt;%</span></span>
<span id="cb153-3"><a href="data-transformations.html#cb153-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y =</span> delay)) <span class="op">+</span></span>
<span id="cb153-4"><a href="data-transformations.html#cb153-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="R4DS_bookdown_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<p>There is another common variation of this type of pattern. Let’s look at how the average performance of batters in baseball is related to the number of time they’re at bat.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="data-transformations.html#cb154-1"></a><span class="kw">library</span>(Lahman)</span></code></pre></div>
<pre><code>## Warning: package &#39;Lahman&#39; was built under R version 4.0.5</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="data-transformations.html#cb156-1"></a><span class="co"># convert to a tibble so it prints nicely</span></span>
<span id="cb156-2"><a href="data-transformations.html#cb156-2"></a>batting &lt;-<span class="st"> </span><span class="kw">as.tibble</span>(Lahman<span class="op">::</span>Batting)</span></code></pre></div>
<pre><code>## Warning: `as.tibble()` was deprecated in tibble 2.0.0.
## Please use `as_tibble()` instead.
## The signature and semantics have changed, see `?as_tibble`.</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="data-transformations.html#cb158-1"></a>batters &lt;-<span class="st"> </span>batting <span class="op">%&gt;%</span></span>
<span id="cb158-2"><a href="data-transformations.html#cb158-2"></a><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></span>
<span id="cb158-3"><a href="data-transformations.html#cb158-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb158-4"><a href="data-transformations.html#cb158-4"></a>    <span class="dt">ba =</span> <span class="kw">sum</span>(H, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(AB, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="co"># batting average</span></span>
<span id="cb158-5"><a href="data-transformations.html#cb158-5"></a>    <span class="dt">ab =</span> <span class="kw">sum</span>(AB, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="co"># at bat</span></span>
<span id="cb158-6"><a href="data-transformations.html#cb158-6"></a>  )</span>
<span id="cb158-7"><a href="data-transformations.html#cb158-7"></a></span>
<span id="cb158-8"><a href="data-transformations.html#cb158-8"></a>batters <span class="op">%&gt;%</span></span>
<span id="cb158-9"><a href="data-transformations.html#cb158-9"></a><span class="st">  </span><span class="kw">filter</span>(ab <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb158-10"><a href="data-transformations.html#cb158-10"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x=</span>ab, <span class="dt">y=</span>ba)) <span class="op">+</span></span>
<span id="cb158-11"><a href="data-transformations.html#cb158-11"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb158-12"><a href="data-transformations.html#cb158-12"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="R4DS_bookdown_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p>Note:
1. The variation in our aggregate decreases as we get more data points
2. There’s a positive correlation between skill (<code>ba</code>) and oppotunities to hit the ball (<code>ab</code>). This is because teams control who gets to play, and obviously pikc their best players.</p>
</div>
<div id="useful-summary-functions" class="section level3">
<h3><span class="header-section-number">5.6.4</span> Useful summary functions</h3>
<p>It is sometimes useful to combine aggregation with logical subsetting.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="data-transformations.html#cb160-1"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb160-2"><a href="data-transformations.html#cb160-2"></a><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb160-3"><a href="data-transformations.html#cb160-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb160-4"><a href="data-transformations.html#cb160-4"></a>    <span class="dt">avg_delay1 =</span> <span class="kw">mean</span>(arr_delay),</span>
<span id="cb160-5"><a href="data-transformations.html#cb160-5"></a>    <span class="dt">avg_delay2 =</span> <span class="kw">mean</span>(arr_delay[arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]) <span class="co"># the average positive delay</span></span>
<span id="cb160-6"><a href="data-transformations.html#cb160-6"></a>  )</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 5
## # Groups:   year, month [12]
##     year month   day avg_delay1 avg_delay2
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1  2013     1     1     12.7         32.5
##  2  2013     1     2     12.7         32.0
##  3  2013     1     3      5.73        27.7
##  4  2013     1     4     -1.93        28.3
##  5  2013     1     5     -1.53        22.6
##  6  2013     1     6      4.24        24.4
##  7  2013     1     7     -4.95        27.8
##  8  2013     1     8     -3.23        20.8
##  9  2013     1     9     -0.264       25.6
## 10  2013     1    10     -5.90        27.3
## # ... with 355 more rows</code></pre>
<p>Measures of spread are also useful.</p>
<ul>
<li>standard deviation: <code>sd()</code></li>
<li>interquartile range: <code>IQR()</code></li>
<li>median abosulation deviation: <code>mad()</code></li>
</ul>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="data-transformations.html#cb163-1"></a><span class="co"># why is the distance to some destinations more variables than others?</span></span>
<span id="cb163-2"><a href="data-transformations.html#cb163-2"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb163-3"><a href="data-transformations.html#cb163-3"></a><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></span>
<span id="cb163-4"><a href="data-transformations.html#cb163-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">distance_sd =</span> <span class="kw">sd</span>(distance)) <span class="op">%&gt;%</span></span>
<span id="cb163-5"><a href="data-transformations.html#cb163-5"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(distance_sd))</span></code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest  distance_sd
##    &lt;chr&gt;       &lt;dbl&gt;
##  1 EGE         10.5 
##  2 SAN         10.4 
##  3 SFO         10.2 
##  4 HNL         10.0 
##  5 SEA          9.98
##  6 LAS          9.91
##  7 PDX          9.87
##  8 PHX          9.86
##  9 LAX          9.66
## 10 IND          9.46
## # ... with 94 more rows</code></pre>
<p>Measures of rank:</p>
<ul>
<li>minimum: <code>min()</code></li>
<li>quantiles: <code>quantile()</code></li>
<li>maximum: <code>max()</code></li>
</ul>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="data-transformations.html#cb165-1"></a><span class="co"># when do the first and last flights leave each day?</span></span>
<span id="cb165-2"><a href="data-transformations.html#cb165-2"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb165-3"><a href="data-transformations.html#cb165-3"></a><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb165-4"><a href="data-transformations.html#cb165-4"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb165-5"><a href="data-transformations.html#cb165-5"></a>    <span class="dt">first =</span> <span class="kw">min</span>(dep_time),</span>
<span id="cb165-6"><a href="data-transformations.html#cb165-6"></a>    <span class="dt">last =</span> <span class="kw">max</span>(dep_time)</span>
<span id="cb165-7"><a href="data-transformations.html#cb165-7"></a>  )</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 5
## # Groups:   year, month [12]
##     year month   day first  last
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1   517  2356
##  2  2013     1     2    42  2354
##  3  2013     1     3    32  2349
##  4  2013     1     4    25  2358
##  5  2013     1     5    14  2357
##  6  2013     1     6    16  2355
##  7  2013     1     7    49  2359
##  8  2013     1     8   454  2351
##  9  2013     1     9     2  2252
## 10  2013     1    10     3  2320
## # ... with 355 more rows</code></pre>
<p>Measures of position:</p>
<ul>
<li>choose first: <code>first()</code></li>
<li>choose nth: <code>nth()</code></li>
<li>choose last: <code>last()</code></li>
</ul>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="data-transformations.html#cb168-1"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb168-2"><a href="data-transformations.html#cb168-2"></a><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb168-3"><a href="data-transformations.html#cb168-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb168-4"><a href="data-transformations.html#cb168-4"></a>    <span class="dt">first_dep =</span> <span class="kw">first</span>(dep_time),</span>
<span id="cb168-5"><a href="data-transformations.html#cb168-5"></a>    <span class="dt">last =</span> <span class="kw">last</span>(dep_time)</span>
<span id="cb168-6"><a href="data-transformations.html#cb168-6"></a>  )</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 5
## # Groups:   year, month [12]
##     year month   day first_dep  last
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt; &lt;int&gt;
##  1  2013     1     1       517  2356
##  2  2013     1     2        42  2354
##  3  2013     1     3        32  2349
##  4  2013     1     4        25  2358
##  5  2013     1     5        14  2357
##  6  2013     1     6        16  2355
##  7  2013     1     7        49  2359
##  8  2013     1     8       454  2351
##  9  2013     1     9         2  2252
## 10  2013     1    10         3  2320
## # ... with 355 more rows</code></pre>
<p>These functions are complementary to filtering on ranks. Filtering gives you all variables, with each observation in a separate row.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="data-transformations.html#cb171-1"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb171-2"><a href="data-transformations.html#cb171-2"></a><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb171-3"><a href="data-transformations.html#cb171-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r=</span><span class="kw">min_rank</span>(<span class="kw">desc</span>(dep_time))) <span class="op">%&gt;%</span></span>
<span id="cb171-4"><a href="data-transformations.html#cb171-4"></a><span class="st">  </span><span class="kw">filter</span>(r <span class="op">%in%</span><span class="st"> </span><span class="kw">range</span>(r))</span></code></pre></div>
<pre><code>## # A tibble: 770 x 20
## # Groups:   year, month, day [365]
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1     2356           2359        -3      425            437
##  3  2013     1     2       42           2359        43      518            442
##  4  2013     1     2     2354           2359        -5      413            437
##  5  2013     1     3       32           2359        33      504            442
##  6  2013     1     3     2349           2359       -10      434            445
##  7  2013     1     4       25           2359        26      505            442
##  8  2013     1     4     2358           2359        -1      429            437
##  9  2013     1     4     2358           2359        -1      436            445
## 10  2013     1     5       14           2359        15      503            445
## # ... with 760 more rows, and 12 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,
## #   r &lt;int&gt;</code></pre>
<p>Counts:</p>
<ul>
<li>count non-missing values: <code>sum(!is.na())</code></li>
<li>count distinct (unique) values: <code>n_distinct()</code></li>
</ul>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="data-transformations.html#cb173-1"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb173-2"><a href="data-transformations.html#cb173-2"></a><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></span>
<span id="cb173-3"><a href="data-transformations.html#cb173-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">carriers =</span> <span class="kw">n_distinct</span>(carrier)) <span class="op">%&gt;%</span></span>
<span id="cb173-4"><a href="data-transformations.html#cb173-4"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(carriers))</span></code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest  carriers
##    &lt;chr&gt;    &lt;int&gt;
##  1 ATL          7
##  2 BOS          7
##  3 CLT          7
##  4 ORD          7
##  5 TPA          7
##  6 AUS          6
##  7 DCA          6
##  8 DTW          6
##  9 IAD          6
## 10 MSP          6
## # ... with 94 more rows</code></pre>
<p>dplyr provides a simple helper if all you want is a count.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="data-transformations.html#cb175-1"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb175-2"><a href="data-transformations.html#cb175-2"></a><span class="st">  </span><span class="kw">count</span>(dest)</span></code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest      n
##    &lt;chr&gt; &lt;int&gt;
##  1 ABQ     254
##  2 ACK     264
##  3 ALB     418
##  4 ANC       8
##  5 ATL   16837
##  6 AUS    2411
##  7 AVL     261
##  8 BDL     412
##  9 BGR     358
## 10 BHM     269
## # ... with 94 more rows</code></pre>
<p>You could also use a wegiht variable. For example, you could use this to sum the total number of miles a plane flew.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="data-transformations.html#cb177-1"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb177-2"><a href="data-transformations.html#cb177-2"></a><span class="st">  </span><span class="kw">count</span>(tailnum, <span class="dt">wt =</span> distance)</span></code></pre></div>
<pre><code>## # A tibble: 4,037 x 2
##    tailnum      n
##    &lt;chr&gt;    &lt;dbl&gt;
##  1 D942DN    3418
##  2 N0EGMQ  239143
##  3 N10156  109664
##  4 N102UW   25722
##  5 N103US   24619
##  6 N104UW   24616
##  7 N10575  139903
##  8 N105UW   23618
##  9 N107US   21677
## 10 N108UW   32070
## # ... with 4,027 more rows</code></pre>
<p>Counts and proportions of logical values:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="data-transformations.html#cb179-1"></a><span class="co"># how many flights left before 5am?</span></span>
<span id="cb179-2"><a href="data-transformations.html#cb179-2"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb179-3"><a href="data-transformations.html#cb179-3"></a><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb179-4"><a href="data-transformations.html#cb179-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n_early =</span> <span class="kw">sum</span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">500</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day n_early
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1     1       0
##  2  2013     1     2       3
##  3  2013     1     3       4
##  4  2013     1     4       3
##  5  2013     1     5       3
##  6  2013     1     6       2
##  7  2013     1     7       2
##  8  2013     1     8       1
##  9  2013     1     9       3
## 10  2013     1    10       3
## # ... with 355 more rows</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="data-transformations.html#cb182-1"></a><span class="co"># what proportion of flights are delayed by more than an hour?</span></span>
<span id="cb182-2"><a href="data-transformations.html#cb182-2"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb182-3"><a href="data-transformations.html#cb182-3"></a><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb182-4"><a href="data-transformations.html#cb182-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">hour_prop =</span> <span class="kw">mean</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day hour_prop
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
##  1  2013     1     1    0.0722
##  2  2013     1     2    0.0851
##  3  2013     1     3    0.0567
##  4  2013     1     4    0.0396
##  5  2013     1     5    0.0349
##  6  2013     1     6    0.0470
##  7  2013     1     7    0.0333
##  8  2013     1     8    0.0213
##  9  2013     1     9    0.0202
## 10  2013     1    10    0.0183
## # ... with 355 more rows</code></pre>
</div>
<div id="grouping-by-multiple-variables" class="section level3">
<h3><span class="header-section-number">5.6.5</span> Grouping by multiple variables</h3>
<p>When you group by multiple variables, each summary peels off one level of the grouping. That makes it easy to progressively roll up a dataset.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="data-transformations.html#cb185-1"></a>daily &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, year, month, day)</span>
<span id="cb185-2"><a href="data-transformations.html#cb185-2"></a>(per_day &lt;-<span class="st"> </span><span class="kw">summarise</span>(daily, <span class="dt">flights=</span><span class="kw">n</span>()))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day flights
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1     1     842
##  2  2013     1     2     943
##  3  2013     1     3     914
##  4  2013     1     4     915
##  5  2013     1     5     720
##  6  2013     1     6     832
##  7  2013     1     7     933
##  8  2013     1     8     899
##  9  2013     1     9     902
## 10  2013     1    10     932
## # ... with 355 more rows</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="data-transformations.html#cb188-1"></a>(per_month &lt;-<span class="st"> </span><span class="kw">summarise</span>(per_day, <span class="dt">flights=</span><span class="kw">sum</span>(flights)))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 12 x 3
## # Groups:   year [1]
##     year month flights
##    &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1   27004
##  2  2013     2   24951
##  3  2013     3   28834
##  4  2013     4   28330
##  5  2013     5   28796
##  6  2013     6   28243
##  7  2013     7   29425
##  8  2013     8   29327
##  9  2013     9   27574
## 10  2013    10   28889
## 11  2013    11   27268
## 12  2013    12   28135</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="data-transformations.html#cb191-1"></a>(per_year &lt;-<span class="st"> </span><span class="kw">summarise</span>(per_month, <span class="dt">flights =</span> <span class="kw">sum</span>(flights)))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    year flights
##   &lt;int&gt;   &lt;int&gt;
## 1  2013  336776</code></pre>
</div>
<div id="ungrouping" class="section level3">
<h3><span class="header-section-number">5.6.6</span> Ungrouping</h3>
<p>If you need to remove grouping, and return to operations on ungrouped data, use <code>ungroup()</code></p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="data-transformations.html#cb193-1"></a>daily <span class="op">%&gt;%</span></span>
<span id="cb193-2"><a href="data-transformations.html#cb193-2"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb193-3"><a href="data-transformations.html#cb193-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">flights =</span> <span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   flights
##     &lt;int&gt;
## 1  336776</code></pre>
</div>
<div id="exercises-11" class="section level3">
<h3><span class="header-section-number">5.6.7</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>Brainstorm at least 5 different ways to assess the typical delay characteristics of a group of flights. Consider the following scenarios:</li>
</ol>
<ul>
<li>a flight is 15 minutes early 50% of the time, and 15 minutes late 50% of the time.</li>
</ul>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="data-transformations.html#cb195-1"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb195-2"><a href="data-transformations.html#cb195-2"></a><span class="st">  </span><span class="kw">group_by</span>(flight) <span class="op">%&gt;%</span></span>
<span id="cb195-3"><a href="data-transformations.html#cb195-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb195-4"><a href="data-transformations.html#cb195-4"></a>    <span class="dt">early_prop =</span> <span class="kw">mean</span>(arr_delay <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>),</span>
<span id="cb195-5"><a href="data-transformations.html#cb195-5"></a>    <span class="dt">late_prop =</span> <span class="kw">mean</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb195-6"><a href="data-transformations.html#cb195-6"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb195-7"><a href="data-transformations.html#cb195-7"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb195-8"><a href="data-transformations.html#cb195-8"></a>    early_prop <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb195-9"><a href="data-transformations.html#cb195-9"></a>    late_prop <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb195-10"><a href="data-transformations.html#cb195-10"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 147 x 3
##    flight early_prop late_prop
##     &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;
##  1     64        0.5       0.5
##  2     69        0.5       0.5
##  3    100        0.5       0.5
##  4    107        0.5       0.5
##  5    110        0.5       0.5
##  6    113        0.5       0.5
##  7    151        0.5       0.5
##  8    154        0.5       0.5
##  9    194        0.5       0.5
## 10    278        0.5       0.5
## # ... with 137 more rows</code></pre>
<ul>
<li>a flight is always 10 minutes late</li>
</ul>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="data-transformations.html#cb197-1"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb197-2"><a href="data-transformations.html#cb197-2"></a><span class="st">  </span><span class="kw">group_by</span>(flight) <span class="op">%&gt;%</span></span>
<span id="cb197-3"><a href="data-transformations.html#cb197-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb197-4"><a href="data-transformations.html#cb197-4"></a>    <span class="dt">late_prop =</span> <span class="kw">mean</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb197-5"><a href="data-transformations.html#cb197-5"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb197-6"><a href="data-transformations.html#cb197-6"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb197-7"><a href="data-transformations.html#cb197-7"></a>    late_prop <span class="op">==</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb197-8"><a href="data-transformations.html#cb197-8"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 147 x 2
##    flight late_prop
##     &lt;int&gt;     &lt;dbl&gt;
##  1     94         1
##  2    730         1
##  3    896         1
##  4    919         1
##  5    955         1
##  6    974         1
##  7    990         1
##  8   1015         1
##  9   1084         1
## 10   1086         1
## # ... with 137 more rows</code></pre>
<ul>
<li>a flights is 30 minutes early 50% of the time, and 30 minutes late 50% of the time</li>
</ul>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="data-transformations.html#cb199-1"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb199-2"><a href="data-transformations.html#cb199-2"></a><span class="st">  </span><span class="kw">group_by</span>(flight) <span class="op">%&gt;%</span></span>
<span id="cb199-3"><a href="data-transformations.html#cb199-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb199-4"><a href="data-transformations.html#cb199-4"></a>    <span class="dt">early_30 =</span> <span class="kw">mean</span>(arr_delay <span class="op">==</span><span class="st"> </span><span class="dv">-30</span>),</span>
<span id="cb199-5"><a href="data-transformations.html#cb199-5"></a>    <span class="dt">late_30 =</span> <span class="kw">mean</span>(arr_delay <span class="op">==</span><span class="st"> </span><span class="dv">30</span>)</span>
<span id="cb199-6"><a href="data-transformations.html#cb199-6"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb199-7"><a href="data-transformations.html#cb199-7"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb199-8"><a href="data-transformations.html#cb199-8"></a>    early_<span class="dv">30</span> <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb199-9"><a href="data-transformations.html#cb199-9"></a>    late_<span class="dv">30</span> <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb199-10"><a href="data-transformations.html#cb199-10"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 0 x 3
## # ... with 3 variables: flight &lt;int&gt;, early_30 &lt;dbl&gt;, late_30 &lt;dbl&gt;</code></pre>
<ul>
<li>99% of the time a flight is on time. 1% of the time it’s 2 hours late.</li>
</ul>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="data-transformations.html#cb201-1"></a>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb201-2"><a href="data-transformations.html#cb201-2"></a><span class="st">  </span><span class="kw">group_by</span>(flight) <span class="op">%&gt;%</span></span>
<span id="cb201-3"><a href="data-transformations.html#cb201-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb201-4"><a href="data-transformations.html#cb201-4"></a>    <span class="dt">early_prop =</span> <span class="kw">mean</span>(arr_delay <span class="op">==</span><span class="st"> </span><span class="dv">0</span>),</span>
<span id="cb201-5"><a href="data-transformations.html#cb201-5"></a>    <span class="dt">late_prop =</span> <span class="kw">mean</span>(arr_delay <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>)</span>
<span id="cb201-6"><a href="data-transformations.html#cb201-6"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb201-7"><a href="data-transformations.html#cb201-7"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb201-8"><a href="data-transformations.html#cb201-8"></a>    early_prop <span class="op">==</span><span class="st"> </span><span class="fl">0.99</span>,</span>
<span id="cb201-9"><a href="data-transformations.html#cb201-9"></a>    late_prop <span class="op">==</span><span class="st"> </span><span class="fl">0.01</span></span>
<span id="cb201-10"><a href="data-transformations.html#cb201-10"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 0 x 3
## # ... with 3 variables: flight &lt;int&gt;, early_prop &lt;dbl&gt;, late_prop &lt;dbl&gt;</code></pre>
<p>Which is more important: arrival delay or departure delay?</p>
<p>We use arrival depature to compute all of these.</p>
<ol start="2" style="list-style-type: decimal">
<li>Come up with another approach that wil give you the same output as <code>not_cancelled %&gt;% count(dest)</code> and <code>not_cancelled %&gt;% count(tailnum, wt = distance)</code> (without using <code>count()</code>)</li>
</ol>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="data-transformations.html#cb203-1"></a><span class="co"># match the first command using n() with summarise()</span></span>
<span id="cb203-2"><a href="data-transformations.html#cb203-2"></a>counts &lt;-<span class="st"> </span>not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(dest)</span>
<span id="cb203-3"><a href="data-transformations.html#cb203-3"></a></span>
<span id="cb203-4"><a href="data-transformations.html#cb203-4"></a>summarise_counts &lt;-<span class="st"> </span>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb203-5"><a href="data-transformations.html#cb203-5"></a><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></span>
<span id="cb203-6"><a href="data-transformations.html#cb203-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">summarise_n =</span> <span class="kw">n</span>())</span>
<span id="cb203-7"><a href="data-transformations.html#cb203-7"></a></span>
<span id="cb203-8"><a href="data-transformations.html#cb203-8"></a><span class="kw">full_join</span>(counts, summarise_counts)</span></code></pre></div>
<pre><code>## Joining, by = &quot;dest&quot;</code></pre>
<pre><code>## # A tibble: 104 x 3
##    dest      n summarise_n
##    &lt;chr&gt; &lt;int&gt;       &lt;int&gt;
##  1 ABQ     254         254
##  2 ACK     264         264
##  3 ALB     418         418
##  4 ANC       8           8
##  5 ATL   16837       16837
##  6 AUS    2411        2411
##  7 AVL     261         261
##  8 BDL     412         412
##  9 BGR     358         358
## 10 BHM     269         269
## # ... with 94 more rows</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="data-transformations.html#cb206-1"></a><span class="co"># match the second command using sum() and summarise()</span></span>
<span id="cb206-2"><a href="data-transformations.html#cb206-2"></a>sums &lt;-<span class="st"> </span>not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(tailnum, <span class="dt">wt=</span>distance)</span>
<span id="cb206-3"><a href="data-transformations.html#cb206-3"></a></span>
<span id="cb206-4"><a href="data-transformations.html#cb206-4"></a>summarise_sums &lt;-<span class="st"> </span>not_cancelled <span class="op">%&gt;%</span></span>
<span id="cb206-5"><a href="data-transformations.html#cb206-5"></a><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></span>
<span id="cb206-6"><a href="data-transformations.html#cb206-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">summarise_n =</span> <span class="kw">sum</span>(distance))</span>
<span id="cb206-7"><a href="data-transformations.html#cb206-7"></a></span>
<span id="cb206-8"><a href="data-transformations.html#cb206-8"></a><span class="kw">full_join</span>(sums, summarise_sums)</span></code></pre></div>
<pre><code>## Joining, by = &quot;tailnum&quot;</code></pre>
<pre><code>## # A tibble: 4,037 x 3
##    tailnum      n summarise_n
##    &lt;chr&gt;    &lt;dbl&gt;       &lt;dbl&gt;
##  1 D942DN    3418        3418
##  2 N0EGMQ  239143      239143
##  3 N10156  109664      109664
##  4 N102UW   25722       25722
##  5 N103US   24619       24619
##  6 N104UW   24616       24616
##  7 N10575  139903      139903
##  8 N105UW   23618       23618
##  9 N107US   21677       21677
## 10 N108UW   32070       32070
## # ... with 4,027 more rows</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Our definition of cancelled flights (<code>is.na(dep_delay) | is.na(arr_delay)</code>) is slightly suboptimal. Why? Which is the most important column?</li>
</ol>
<p><code>arr_delay</code> is the most important column because there seems to be flights with <code>dep_delay</code> entries even though the <code>arr_delay</code> is NA.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="data-transformations.html#cb209-1"></a><span class="co"># arr_delay is NA but dep_delay is not NA</span></span>
<span id="cb209-2"><a href="data-transformations.html#cb209-2"></a><span class="kw">filter</span>(flights, </span>
<span id="cb209-3"><a href="data-transformations.html#cb209-3"></a>       <span class="kw">is.na</span>(arr_delay),</span>
<span id="cb209-4"><a href="data-transformations.html#cb209-4"></a>       <span class="op">!</span><span class="kw">is.na</span>(dep_delay))</span></code></pre></div>
<pre><code>## # A tibble: 1,175 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1     1525           1530        -5     1934           1805
##  2  2013     1     1     1528           1459        29     2002           1647
##  3  2013     1     1     1740           1745        -5     2158           2020
##  4  2013     1     1     1807           1738        29     2251           2103
##  5  2013     1     1     1939           1840        59       29           2151
##  6  2013     1     1     1952           1930        22     2358           2207
##  7  2013     1     1     2016           1930        46       NA           2220
##  8  2013     1     2      905            822        43     1313           1045
##  9  2013     1     2     1125            925       120     1445           1146
## 10  2013     1     2     1848           1840         8     2333           2151
## # ... with 1,165 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="data-transformations.html#cb211-1"></a><span class="co"># dep_delay is NA but arr_delay is not NA - no flights here</span></span>
<span id="cb211-2"><a href="data-transformations.html#cb211-2"></a><span class="kw">filter</span>(flights,</span>
<span id="cb211-3"><a href="data-transformations.html#cb211-3"></a>       <span class="kw">is.na</span>(dep_delay),</span>
<span id="cb211-4"><a href="data-transformations.html#cb211-4"></a>       <span class="op">!</span><span class="kw">is.na</span>(arr_delay))</span></code></pre></div>
<pre><code>## # A tibble: 0 x 19
## # ... with 19 variables: year &lt;int&gt;, month &lt;int&gt;, day &lt;int&gt;, dep_time &lt;int&gt;,
## #   sched_dep_time &lt;int&gt;, dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Look at the number of cancelled flights per day. Is there a pattern? Is the proportion of cancelled flights related to the average delay?</li>
</ol>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="data-transformations.html#cb213-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb213-2"><a href="data-transformations.html#cb213-2"></a><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb213-3"><a href="data-transformations.html#cb213-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb213-4"><a href="data-transformations.html#cb213-4"></a>    <span class="dt">prop_cancelled =</span> <span class="kw">mean</span>(<span class="kw">is.na</span>(arr_delay)), <span class="co"># proportion cancelled</span></span>
<span id="cb213-5"><a href="data-transformations.html#cb213-5"></a>    <span class="dt">avg_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb213-6"><a href="data-transformations.html#cb213-6"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb213-7"><a href="data-transformations.html#cb213-7"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>prop_cancelled, <span class="dt">y=</span>avg_delay)) <span class="op">+</span></span>
<span id="cb213-8"><a href="data-transformations.html#cb213-8"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<p><img src="R4DS_bookdown_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>There seems to be a slight positive relationship between <code>avg_delay</code> and <code>prop_cancelled</code>, however there are some outlier days.</p>
<ol start="5" style="list-style-type: decimal">
<li>Which carrier has the worst delays? Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about <code>flights %&gt;% group_by(carrier, dest) %&gt;% summarise(n)))</code></li>
</ol>
<p>We have to decide whether departure or arrival delays are more important. Let’s check the relationship between the two.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="data-transformations.html#cb215-1"></a><span class="kw">ggplot</span>(flights) <span class="op">+</span></span>
<span id="cb215-2"><a href="data-transformations.html#cb215-2"></a><span class="st">  </span><span class="kw">geom_count</span>(<span class="kw">aes</span>(<span class="dt">x=</span>arr_delay,</span>
<span id="cb215-3"><a href="data-transformations.html#cb215-3"></a>                 <span class="dt">y=</span>dep_delay,</span>
<span id="cb215-4"><a href="data-transformations.html#cb215-4"></a>                <span class="dt">size=</span>..n..,</span>
<span id="cb215-5"><a href="data-transformations.html#cb215-5"></a>                <span class="dt">color=</span>..n..)) <span class="op">+</span></span>
<span id="cb215-6"><a href="data-transformations.html#cb215-6"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="st">&#39;legend&#39;</span>) <span class="op">+</span></span>
<span id="cb215-7"><a href="data-transformations.html#cb215-7"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">color=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 9430 rows containing non-finite values (stat_sum).</code></pre>
<p><img src="R4DS_bookdown_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<p>The two types of delays are quite similar with no obvious pattern of one being less than the other. It looks like there are more points under the red line, indicating that arrival delays tend to be shorter than departure delays. This makes sense because time can be made up during a smooth flight. It’s probably more important to people if they arrive at their destination on time, so we’ll go with arrival time.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="data-transformations.html#cb217-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb217-2"><a href="data-transformations.html#cb217-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb217-3"><a href="data-transformations.html#cb217-3"></a><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span></span>
<span id="cb217-4"><a href="data-transformations.html#cb217-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">max_delay =</span> <span class="kw">max</span>(dep_delay)) <span class="op">%&gt;%</span></span>
<span id="cb217-5"><a href="data-transformations.html#cb217-5"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(max_delay))</span></code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    carrier max_delay
##    &lt;chr&gt;       &lt;dbl&gt;
##  1 HA           1301
##  2 MQ           1137
##  3 AA           1014
##  4 DL            960
##  5 F9            853
##  6 9E            747
##  7 VX            653
##  8 FL            602
##  9 EV            548
## 10 B6            502
## 11 US            500
## 12 UA            483
## 13 WN            471
## 14 YV            387
## 15 AS            225
## 16 OO            154</code></pre>
<p>We remove the flights with NA values for arrival delay since we can’t do anything with those. We see that carriers with the worst delays are HA, MQ, and AA.</p>
<p>Now we’ll try disentagling effects of bad airports vs. bad carriers. We’ll group by the carrier and origin airport to find the max delays between these pairs. Then we can pass the results to <code>ggplot</code> so we can easily visualize them as a heatmap. We’re still seeing HA and MQ carriers stand out, and JFK airport seems to have a lot of arrival delays. We could follow the same procedure for destination airports as well.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="data-transformations.html#cb219-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb219-2"><a href="data-transformations.html#cb219-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb219-3"><a href="data-transformations.html#cb219-3"></a><span class="st">  </span><span class="kw">group_by</span>(carrier, origin) <span class="op">%&gt;%</span></span>
<span id="cb219-4"><a href="data-transformations.html#cb219-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">max_delay =</span> <span class="kw">max</span>(dep_delay)) <span class="op">%&gt;%</span></span>
<span id="cb219-5"><a href="data-transformations.html#cb219-5"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(max_delay)) <span class="op">%&gt;%</span></span>
<span id="cb219-6"><a href="data-transformations.html#cb219-6"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb219-7"><a href="data-transformations.html#cb219-7"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x=</span>origin,</span>
<span id="cb219-8"><a href="data-transformations.html#cb219-8"></a>                <span class="dt">y=</span>carrier,</span>
<span id="cb219-9"><a href="data-transformations.html#cb219-9"></a>                <span class="dt">fill=</span>max_delay))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;carrier&#39;. You can override using the `.groups` argument.</code></pre>
<p><img src="R4DS_bookdown_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<ol start="6" style="list-style-type: decimal">
<li>What does the <code>sort</code> argument to <code>count()</code> do. When might you use it?</li>
</ol>
<p>The <code>count()</code> function will count the unique values of one or more variables, and the <code>sort</code> argumnet will display the largest groups at the top.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="data-transformations.html#cb221-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb221-2"><a href="data-transformations.html#cb221-2"></a><span class="st">  </span><span class="kw">count</span>(carrier, <span class="dt">sort=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    carrier     n
##    &lt;chr&gt;   &lt;int&gt;
##  1 UA      58665
##  2 B6      54635
##  3 EV      54173
##  4 DL      48110
##  5 AA      32729
##  6 MQ      26397
##  7 US      20536
##  8 9E      18460
##  9 WN      12275
## 10 VX       5162
## 11 FL       3260
## 12 AS        714
## 13 F9        685
## 14 YV        601
## 15 HA        342
## 16 OO         32</code></pre>
</div>
</div>
<div id="grouped-mutates-and-filters" class="section level2">
<h2><span class="header-section-number">5.7</span> Grouped mutates (and filters)</h2>
<p>Grouping is most useful in conjunction with <code>summarise()</code>, but you can also do convenient operations with <code>mutate()</code> and <code>filter()</code>.</p>
<p>Find the worst members of each group:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="data-transformations.html#cb223-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb223-2"><a href="data-transformations.html#cb223-2"></a><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb223-3"><a href="data-transformations.html#cb223-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">rank</span>(<span class="kw">desc</span>(arr_delay)) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3,306 x 19
## # Groups:   year, month, day [365]
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      848           1835       853     1001           1950
##  2  2013     1     1     1815           1325       290     2120           1542
##  3  2013     1     1     1842           1422       260     1958           1535
##  4  2013     1     1     1942           1705       157     2124           1830
##  5  2013     1     1     2006           1630       216     2230           1848
##  6  2013     1     1     2115           1700       255     2330           1920
##  7  2013     1     1     2205           1720       285       46           2040
##  8  2013     1     1     2312           2000       192       21           2110
##  9  2013     1     1     2343           1724       379      314           1938
## 10  2013     1     2     1244            900       224     1431           1104
## # ... with 3,296 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Find all groups bigger than a threshold</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="data-transformations.html#cb225-1"></a>popular_dests &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></span>
<span id="cb225-2"><a href="data-transformations.html#cb225-2"></a><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></span>
<span id="cb225-3"><a href="data-transformations.html#cb225-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">365</span>)</span>
<span id="cb225-4"><a href="data-transformations.html#cb225-4"></a>popular_dests</span></code></pre></div>
<pre><code>## # A tibble: 332,577 x 19
## # Groups:   dest [77]
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 332,567 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Standardise to compute per group metrics</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="data-transformations.html#cb227-1"></a>popular_dests <span class="op">%&gt;%</span></span>
<span id="cb227-2"><a href="data-transformations.html#cb227-2"></a><span class="st">  </span><span class="kw">filter</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb227-3"><a href="data-transformations.html#cb227-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop_delay =</span> arr_delay <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb227-4"><a href="data-transformations.html#cb227-4"></a><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, dest, arr_delay, prop_delay)</span></code></pre></div>
<pre><code>## # A tibble: 131,106 x 6
## # Groups:   dest [77]
##     year month   day dest  arr_delay prop_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1  2013     1     1 IAH          11  0.000111 
##  2  2013     1     1 IAH          20  0.000201 
##  3  2013     1     1 MIA          33  0.000235 
##  4  2013     1     1 ORD          12  0.0000424
##  5  2013     1     1 FLL          19  0.0000938
##  6  2013     1     1 ORD           8  0.0000283
##  7  2013     1     1 LAX           7  0.0000344
##  8  2013     1     1 DFW          31  0.000282 
##  9  2013     1     1 ATL          12  0.0000400
## 10  2013     1     1 DTW          16  0.000116 
## # ... with 131,096 more rows</code></pre>
<div id="exercises-12" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Refer back to the lists of useful mutate and filtering functions. Describe how each operation changes when you combine it with grouping.</p></li>
<li><p>Which plane (tailnum) has the worst on-time record?</p></li>
</ol>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="data-transformations.html#cb229-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb229-2"><a href="data-transformations.html#cb229-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb229-3"><a href="data-transformations.html#cb229-3"></a><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></span>
<span id="cb229-4"><a href="data-transformations.html#cb229-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">max_delay=</span><span class="kw">max</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb229-5"><a href="data-transformations.html#cb229-5"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(max_delay)) <span class="op">%&gt;%</span></span>
<span id="cb229-6"><a href="data-transformations.html#cb229-6"></a><span class="st">  </span><span class="kw">select</span>(tailnum, max_delay) <span class="op">%&gt;%</span></span>
<span id="cb229-7"><a href="data-transformations.html#cb229-7"></a><span class="st">  </span><span class="kw">unique</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4,037 x 2
## # Groups:   tailnum [4,037]
##    tailnum max_delay
##    &lt;chr&gt;       &lt;dbl&gt;
##  1 N384HA       1272
##  2 N504MQ       1127
##  3 N517MQ       1109
##  4 N338AA       1007
##  5 N665MQ        989
##  6 N959DL        931
##  7 N927DA        915
##  8 N6716C        895
##  9 N5DMAA        878
## 10 N523MQ        875
## # ... with 4,027 more rows</code></pre>
<p>The worse on-time record is held by flight N384HA with a 1272 arrival delay.</p>
<ol start="3" style="list-style-type: decimal">
<li>What time of day should you fly if you want to avoid delays as much as possible?</li>
</ol>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="data-transformations.html#cb231-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb231-2"><a href="data-transformations.html#cb231-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb231-3"><a href="data-transformations.html#cb231-3"></a><span class="st">  </span><span class="kw">group_by</span>(sched_dep_time) <span class="op">%&gt;%</span></span>
<span id="cb231-4"><a href="data-transformations.html#cb231-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_delay =</span> <span class="kw">mean</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb231-5"><a href="data-transformations.html#cb231-5"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(avg_delay))</span></code></pre></div>
<pre><code>## # A tibble: 1,020 x 2
##    sched_dep_time avg_delay
##             &lt;int&gt;     &lt;dbl&gt;
##  1           2207     105. 
##  2           1848      69  
##  3           1752      68.2
##  4           1531      65.1
##  5           2339      59  
##  6           1739      56.1
##  7           1653      55.4
##  8           1747      54.6
##  9            558      54.3
## 10           2103      52.4
## # ... with 1,010 more rows</code></pre>
<p>The worst average delay occurs with flights that are scheduled to depart at 2207.</p>
<ol start="4" style="list-style-type: decimal">
<li>For each destination, compute the total minutes of delay. For each flight, compute the proportion of the total delay for its destination.</li>
</ol>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="data-transformations.html#cb233-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb233-2"><a href="data-transformations.html#cb233-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb233-3"><a href="data-transformations.html#cb233-3"></a><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></span>
<span id="cb233-4"><a href="data-transformations.html#cb233-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop_delay =</span> arr_delay <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb233-5"><a href="data-transformations.html#cb233-5"></a><span class="st">  </span><span class="kw">select</span>(tailnum, arr_delay, prop_delay)</span></code></pre></div>
<pre><code>## # A tibble: 327,346 x 3
## # Groups:   tailnum [4,037]
##    tailnum arr_delay prop_delay
##    &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
##  1 N14228         11    0.0267 
##  2 N24211         20    0.0200 
##  3 N619AA         33    0.188  
##  4 N804JB        -18    0.045  
##  5 N668DN        -25   -0.198  
##  6 N39463         12    0.0519 
##  7 N516JB         19    0.00556
##  8 N829AS        -14   -0.00379
##  9 N593JB         -8   -0.00217
## 10 N3ALAA          8    0.0354 
## # ... with 327,336 more rows</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Delays are typically temporally correlated: even once the problem that caused the inital delay has been removed, later flights are delayed to allow earlier flights to leave. Using <code>lag()</code>, explore how the delay of a flight is related to the delay of the immeidately preceding flight.</li>
</ol>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="data-transformations.html#cb235-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb235-2"><a href="data-transformations.html#cb235-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb235-3"><a href="data-transformations.html#cb235-3"></a><span class="st">  </span><span class="kw">group_by</span>(origin) <span class="op">%&gt;%</span></span>
<span id="cb235-4"><a href="data-transformations.html#cb235-4"></a><span class="st">  </span><span class="kw">arrange</span>(sched_dep_time) <span class="op">%&gt;%</span></span>
<span id="cb235-5"><a href="data-transformations.html#cb235-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prev_delay =</span> <span class="kw">lag</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb235-6"><a href="data-transformations.html#cb235-6"></a><span class="st">  </span><span class="kw">select</span>(flight, arr_delay, prev_delay) <span class="op">%&gt;%</span></span>
<span id="cb235-7"><a href="data-transformations.html#cb235-7"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb235-8"><a href="data-transformations.html#cb235-8"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>prev_delay,</span>
<span id="cb235-9"><a href="data-transformations.html#cb235-9"></a>                 <span class="dt">y=</span>arr_delay))</span></code></pre></div>
<pre><code>## Adding missing grouping variables: `origin`</code></pre>
<pre><code>## Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<p><img src="R4DS_bookdown_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<p>The y-axis shows the arrival delay for a particular flight, and the x-axis shows the arrival delay for the flight that was scheduled to depart just before it from the same origina airport. The plot doesn’t really show a strong relationship between the arrival delay of flights and the flights that departs immediately before.</p>
<ol start="6" style="list-style-type: decimal">
<li>Look at each destination. Can you find flights that are suspicously fast? (i.e. flights that represent a potential data entry error). Compute the air time of a flight relative to the shortest flight to that destination. Which flights were most delayed in the air?</li>
</ol>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="data-transformations.html#cb238-1"></a>flight_speed &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></span>
<span id="cb238-2"><a href="data-transformations.html#cb238-2"></a><span class="st">  </span><span class="kw">select</span>(flight, tailnum, origin, dest, air_time, distance) <span class="op">%&gt;%</span></span>
<span id="cb238-3"><a href="data-transformations.html#cb238-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">speed =</span>  distance <span class="op">/</span><span class="st"> </span>(air_time<span class="op">/</span><span class="dv">60</span>)) <span class="op">%&gt;%</span></span>
<span id="cb238-4"><a href="data-transformations.html#cb238-4"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(speed))</span>
<span id="cb238-5"><a href="data-transformations.html#cb238-5"></a></span>
<span id="cb238-6"><a href="data-transformations.html#cb238-6"></a>flight_speed</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 7
##    flight tailnum origin dest  air_time distance speed
##     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1   1499 N666DN  LGA    ATL         65      762  703.
##  2   4667 N17196  EWR    MSP         93     1008  650.
##  3   4292 N14568  EWR    GSP         55      594  648 
##  4   3805 N12567  EWR    BNA         70      748  641.
##  5   1902 N956DL  LGA    PBI        105     1035  591.
##  6    315 N3768   JFK    SJU        170     1598  564 
##  7    707 N779JB  JFK    SJU        172     1598  557.
##  8    936 N5FFAA  JFK    STT        175     1623  556.
##  9    347 N3773D  JFK    SJU        173     1598  554.
## 10   1503 N571JB  JFK    SJU        173     1598  554.
## # ... with 336,766 more rows</code></pre>
<p>We compute the speed of each flight by taking the distance traveled (<code>distance</code>) divided by the time spend in the air (<code>air_time</code>). The air time is in minutes, so we divide by 60 to get speed in miles per hour. We can look at the distribution of flight speeds to find outliers.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="data-transformations.html#cb240-1"></a><span class="kw">summary</span>(flight_speed<span class="op">$</span>speed)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##    76.8   358.1   404.2   394.3   438.8   703.4    9430</code></pre>
<p>It looks like the median flight speed is about 404 miles per hour, and 75% of flights are flying under 438 miles per hour. This suggests that our fastest flights at about 600-700 miles per hour are quite fast compared to average flights.</p>
<p>We can now look at each flight’s air time in a destination-specific manner.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="data-transformations.html#cb242-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb242-2"><a href="data-transformations.html#cb242-2"></a><span class="st">  </span><span class="kw">group_by</span>(origin, dest) <span class="op">%&gt;%</span></span>
<span id="cb242-3"><a href="data-transformations.html#cb242-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(air_time)) <span class="op">%&gt;%</span></span>
<span id="cb242-4"><a href="data-transformations.html#cb242-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time_diff =</span> air_time <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(air_time)) <span class="op">%&gt;%</span></span>
<span id="cb242-5"><a href="data-transformations.html#cb242-5"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(time_diff)) <span class="op">%&gt;%</span></span>
<span id="cb242-6"><a href="data-transformations.html#cb242-6"></a><span class="st">  </span><span class="kw">select</span>(carrier<span class="op">:</span>air_time, time_diff) <span class="op">%&gt;%</span></span>
<span id="cb242-7"><a href="data-transformations.html#cb242-7"></a><span class="st">  </span><span class="kw">group_by</span>(origin, dest) <span class="op">%&gt;%</span></span>
<span id="cb242-8"><a href="data-transformations.html#cb242-8"></a><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb242-9"><a href="data-transformations.html#cb242-9"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(time_diff))</span></code></pre></div>
<pre><code>## # A tibble: 223 x 7
## # Groups:   origin, dest [223]
##    carrier flight tailnum origin dest  air_time time_diff
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 DL         841 N703TW  JFK    SFO        490       189
##  2 DL         426 N178DN  JFK    LAX        440       165
##  3 AA         575 N5DBAA  JFK    EGE        382       163
##  4 UA         745 N578UA  LGA    DEN        331       145
##  5 UA         587 N852UA  EWR    LAS        399       143
##  6 UA          15 N77066  EWR    HNL        695       133
##  7 B6          89 N794JB  JFK    SAN        413       132
##  8 UA        1075 N16709  EWR    SNA        405       131
##  9 UA        1178 N18243  EWR    AUS        301       127
## 10 B6        1295 N593JB  JFK    AUS        301       126
## # ... with 213 more rows</code></pre>
<p>We group by the origin and destination so we can compare similar flights. Then compute the difference between air time and the minimum air time for flights on the same route. Then we can sort and take the flight with the largest time difference. Here we see that the largest time difference occurs for flight 841 from JFK to SFO.</p>
<ol start="8" style="list-style-type: decimal">
<li>For each plane, count the number of flights before the first delay of greater than 1 hour.</li>
</ol>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="data-transformations.html#cb244-1"></a>delayed &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></span>
<span id="cb244-2"><a href="data-transformations.html#cb244-2"></a><span class="st">  </span><span class="kw">group_by</span>(tailnum, year, month, day) <span class="op">%&gt;%</span></span>
<span id="cb244-3"><a href="data-transformations.html#cb244-3"></a><span class="st">  </span><span class="kw">arrange</span>(dep_time) <span class="op">%&gt;%</span></span>
<span id="cb244-4"><a href="data-transformations.html#cb244-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">num_prior_delay =</span> <span class="kw">sum</span>(arr_delay <span class="op">&lt;</span><span class="st"> </span><span class="dv">60</span>),</span>
<span id="cb244-5"><a href="data-transformations.html#cb244-5"></a>          <span class="dt">num_delayed =</span> <span class="kw">sum</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>),</span>
<span id="cb244-6"><a href="data-transformations.html#cb244-6"></a>          <span class="dt">prop_prior_delayed =</span> num_prior_delay <span class="op">/</span><span class="st"> </span>(num_delayed <span class="op">+</span><span class="st"> </span>num_prior_delay)) <span class="op">%&gt;%</span></span>
<span id="cb244-7"><a href="data-transformations.html#cb244-7"></a><span class="st">  </span><span class="kw">select</span>(tailnum, year, month, day, num_prior_delay, num_delayed, prop_prior_delayed)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;tailnum&#39;, &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="data-transformations.html#cb246-1"></a>delayed</span></code></pre></div>
<pre><code>## # A tibble: 251,727 x 7
## # Groups:   tailnum, year, month [37,988]
##    tailnum  year month   day num_prior_delay num_delayed prop_prior_delayed
##    &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;           &lt;int&gt;       &lt;int&gt;              &lt;dbl&gt;
##  1 D942DN   2013     2    11               0           1                0  
##  2 D942DN   2013     3    23               1           0                1  
##  3 D942DN   2013     3    24               1           0                1  
##  4 D942DN   2013     7     5               1           0                1  
##  5 N0EGMQ   2013     1     1               1           1                0.5
##  6 N0EGMQ   2013     1     2               2           0                1  
##  7 N0EGMQ   2013     1     4               1           0                1  
##  8 N0EGMQ   2013     1     5               1           0                1  
##  9 N0EGMQ   2013     1     6               2           0                1  
## 10 N0EGMQ   2013     1     7               3           0                1  
## # ... with 251,717 more rows</code></pre>
<p>These show the number of flights that were delayed, the number of flights prior to the delay, and the proportion of flights that occurred prior to the delay of one hour. This code assumes that once a flight is delayed by 1 hour in a specific day, it is never returns back to schedule. We can look at a summary of these numbers.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="data-transformations.html#cb248-1"></a><span class="kw">summary</span>(delayed)</span></code></pre></div>
<pre><code>##    tailnum               year          month             day       
##  Length:251727      Min.   :2013   Min.   : 1.000   Min.   : 1.00  
##  Class :character   1st Qu.:2013   1st Qu.: 4.000   1st Qu.: 8.00  
##  Mode  :character   Median :2013   Median : 7.000   Median :16.00  
##                     Mean   :2013   Mean   : 6.565   Mean   :15.73  
##                     3rd Qu.:2013   3rd Qu.:10.000   3rd Qu.:23.00  
##                     Max.   :2013   Max.   :12.000   Max.   :31.00  
##                                                                    
##  num_prior_delay  num_delayed    prop_prior_delayed
##  Min.   :0.000   Min.   :0.000   Min.   :0.000     
##  1st Qu.:1.000   1st Qu.:0.000   1st Qu.:1.000     
##  Median :1.000   Median :0.000   Median :1.000     
##  Mean   :1.205   Mean   :0.108   Mean   :0.919     
##  3rd Qu.:1.000   3rd Qu.:0.000   3rd Qu.:1.000     
##  Max.   :5.000   Max.   :4.000   Max.   :1.000     
##  NA&#39;s   :6661    NA&#39;s   :6661    NA&#39;s   :6933</code></pre>
<p>It looks like there is typically 1 flights before a plane is delayed by 1 at least one hour, with a maximum of 5 flights prior to the first 1 hour delay. However, it seems that most of the flights are not delayed by more than one hour in a specific day.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="workflow.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="workflow-scripts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R4DS_bookdown.pdf", "R4DS_bookdown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
